
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>vetbot: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/drerr0r/vetbot/cmd/vetbot/main.go (0.0%)</option>
				
				<option value="file1">github.com/drerr0r/vetbot/internal/database/database.go (3.9%)</option>
				
				<option value="file2">github.com/drerr0r/vetbot/internal/database/database_testutils.go (21.4%)</option>
				
				<option value="file3">github.com/drerr0r/vetbot/internal/handlers/adapters.go (0.0%)</option>
				
				<option value="file4">github.com/drerr0r/vetbot/internal/handlers/admin_handlers.go (0.1%)</option>
				
				<option value="file5">github.com/drerr0r/vetbot/internal/handlers/bot_handlers.go (12.5%)</option>
				
				<option value="file6">github.com/drerr0r/vetbot/internal/handlers/main_handler.go (18.8%)</option>
				
				<option value="file7">github.com/drerr0r/vetbot/internal/handlers/test_utils.go (60.9%)</option>
				
				<option value="file8">github.com/drerr0r/vetbot/internal/handlers/vet_handlers.go (72.8%)</option>
				
				<option value="file9">github.com/drerr0r/vetbot/pkg/utils/config.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package main

import (
        "log"
        "os"
        "os/signal"
        "strings"
        "syscall"

        "github.com/drerr0r/vetbot/internal/database"
        "github.com/drerr0r/vetbot/internal/handlers"
        "github.com/drerr0r/vetbot/pkg/utils"
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

func main() <span class="cov0" title="0">{
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config, err := utils.LoadConfig()
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Error loading config: %v", err)
        }</span>

        <span class="cov0" title="0">log.Printf("Telegram token loaded: %s...", maskToken(config.TelegramToken))
        log.Printf("Database URL loaded: %s", maskDBPassword(config.DatabaseURL))
        log.Printf("Debug mode: %t", config.Debug)
        log.Printf("Admin IDs: %v", config.AdminIDs)

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç–∞ Telegram
        bot, err := tgbotapi.NewBotAPI(config.TelegramToken)
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Error creating bot: %v", err)
        }</span>

        <span class="cov0" title="0">bot.Debug = config.Debug
        log.Printf("Authorized on account %s", bot.Self.UserName)

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        db, err := database.New(config.DatabaseURL)
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Error connecting to database: %v", err)
        }</span>
        <span class="cov0" title="0">defer db.Close()

        // –î–û–ë–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        log.Println("Checking and adding missing database columns...")
        err = db.AddMissingColumns()
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Warning: could not add missing columns: %v", err)
        }</span> else<span class="cov0" title="0"> {
                log.Println("Database columns check completed successfully")
        }</span>

        // –°–æ–∑–¥–∞–µ–º –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –±–æ—Ç–∞
        <span class="cov0" title="0">botAdapter := handlers.NewTelegramBotAdapter(bot)

        // –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        mainHandler := handlers.NewMainHandler(botAdapter, db, config)

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º long polling
        u := tgbotapi.NewUpdate(0)
        u.Timeout = 60

        updates := bot.GetUpdatesChan(u)

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è graceful shutdown
        sigChan := make(chan os.Signal, 1)
        signal.Notify(sigChan, syscall.SIGINT, syscall.SIGTERM)

        log.Println("Bot started. Press Ctrl+C to stop.")

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        for </span><span class="cov0" title="0">{
                select </span>{
                case update := &lt;-updates:<span class="cov0" title="0">
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ç–æ–π –∂–µ –≥–æ—Ä—É—Ç–∏–Ω–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
                        mainHandler.HandleUpdate(update)</span>
                case &lt;-sigChan:<span class="cov0" title="0">
                        log.Println("Shutting down bot gracefully...")
                        return</span>
                }
        }
}

// maskToken –º–∞—Å–∫–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
func maskToken(token string) string <span class="cov0" title="0">{
        if len(token) &lt;= 10 </span><span class="cov0" title="0">{
                return "***"
        }</span>
        <span class="cov0" title="0">return token[:10] + "..."</span>
}

// maskDBPassword –º–∞—Å–∫–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å –≤ URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
func maskDBPassword(dbURL string) string <span class="cov0" title="0">{
        parts := strings.Split(dbURL, "@")
        if len(parts) != 2 </span><span class="cov0" title="0">{
                return dbURL
        }</span>

        <span class="cov0" title="0">authPart := parts[0]
        if strings.Contains(authPart, ":") </span><span class="cov0" title="0">{
                authParts := strings.Split(authPart, ":")
                if len(authParts) &gt;= 3 </span><span class="cov0" title="0">{ // postgres://user:password@
                        // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –ø–∞—Ä–æ–ª—è
                        userPass := strings.Split(authParts[2], "@")
                        if len(userPass) &gt;= 2 </span><span class="cov0" title="0">{
                                // –ú–∞—Å–∫–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
                                return authParts[0] + "://" + authParts[1] + ":***@" + parts[1]
                        }</span>
                } else<span class="cov0" title="0"> if len(authParts) == 2 &amp;&amp; strings.Contains(authParts[0], "//") </span><span class="cov0" title="0">{
                        // –§–æ—Ä–º–∞—Ç user:password@host
                        protocolParts := strings.Split(authParts[0], "//")
                        if len(protocolParts) == 2 </span><span class="cov0" title="0">{
                                return protocolParts[0] + "//" + protocolParts[1] + ":***@" + parts[1]
                        }</span>
                }
        }

        <span class="cov0" title="0">return dbURL</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package database

import (
        "database/sql"
        "fmt"
        "log"

        "github.com/drerr0r/vetbot/internal/models"
        _ "github.com/lib/pq"
)

// Database –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±–µ—Ä—Ç–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
type Database struct {
        db *sql.DB
}

// New —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
func New(dataSourceName string) (*Database, error) <span class="cov8" title="1">{
        db, err := sql.Open("postgres", dataSourceName)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov8" title="1">if err := db.Ping(); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>

        <span class="cov0" title="0">log.Println("Successfully connected to database")
        return &amp;Database{db: db}, nil</span>
}

// Close –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
func (d *Database) Close() error <span class="cov8" title="1">{
        if d == nil || d.db == nil </span><span class="cov8" title="1">{
                return nil // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º nil –¥–ª—è nil –æ–±—ä–µ–∫—Ç–∞
        }</span>
        <span class="cov0" title="0">return d.db.Close()</span>
}

// GetDB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func (d *Database) GetDB() *sql.DB <span class="cov0" title="0">{
        return d.db
}</span>

// CreateUser —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
func (d *Database) CreateUser(user *models.User) error <span class="cov0" title="0">{
        query := `INSERT INTO users (telegram_id, username, first_name, last_name, phone) 
                  VALUES ($1, $2, $3, $4, $5) 
                  ON CONFLICT (telegram_id) DO UPDATE SET 
                  username = EXCLUDED.username, 
                  first_name = EXCLUDED.first_name, 
                  last_name = EXCLUDED.last_name, 
                  phone = EXCLUDED.phone
                  RETURNING id, created_at`

        err := d.db.QueryRow(query, user.TelegramID, user.Username, user.FirstName, user.LastName, user.Phone).
                Scan(&amp;user.ID, &amp;user.CreatedAt)
        return err
}</span>

// GetAllSpecializations –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (d *Database) GetAllSpecializations() ([]*models.Specialization, error) <span class="cov0" title="0">{
        rows, err := d.db.Query("SELECT id, name, description, created_at FROM specializations ORDER BY name")
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var specializations []*models.Specialization
        for rows.Next() </span><span class="cov0" title="0">{
                var spec models.Specialization
                err := rows.Scan(&amp;spec.ID, &amp;spec.Name, &amp;spec.Description, &amp;spec.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov0" title="0">specializations = append(specializations, &amp;spec)</span>
        }

        <span class="cov0" title="0">return specializations, nil</span>
}

// GetSpecializationByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ ID
func (d *Database) GetSpecializationByID(id int) (*models.Specialization, error) <span class="cov0" title="0">{
        var spec models.Specialization
        err := d.db.QueryRow("SELECT id, name, description, created_at FROM specializations WHERE id = $1", id).
                Scan(&amp;spec.ID, &amp;spec.Name, &amp;spec.Description, &amp;spec.CreatedAt)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return &amp;spec, nil</span>
}

// SpecializationExists –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (d *Database) SpecializationExists(id int) (bool, error) <span class="cov0" title="0">{
        var exists bool
        err := d.db.QueryRow("SELECT EXISTS(SELECT 1 FROM specializations WHERE id = $1)", id).Scan(&amp;exists)
        return exists, err
}</span>

// GetVeterinariansBySpecialization –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–∞—á–µ–π –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (d *Database) GetVeterinariansBySpecialization(specializationID int) ([]*models.Veterinarian, error) <span class="cov0" title="0">{
        query := `
                SELECT DISTINCT v.id, v.first_name, v.last_name, v.phone, v.email, 
                       v.description, v.experience_years, v.is_active, v.created_at
                FROM veterinarians v
                INNER JOIN vet_specializations vs ON v.id = vs.vet_id
                WHERE vs.specialization_id = $1 AND v.is_active = true
                ORDER BY v.first_name, v.last_name`

        rows, err := d.db.Query(query, specializationID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var veterinarians []*models.Veterinarian
        for rows.Next() </span><span class="cov0" title="0">{
                var vet models.Veterinarian
                err := rows.Scan(&amp;vet.ID, &amp;vet.FirstName, &amp;vet.LastName, &amp;vet.Phone, &amp;vet.Email,
                        &amp;vet.Description, &amp;vet.ExperienceYears, &amp;vet.IsActive, &amp;vet.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–∞—á–∞
                <span class="cov0" title="0">specs, err := d.GetSpecializationsByVetID(vet.ID)
                if err == nil </span><span class="cov0" title="0">{
                        vet.Specializations = specs
                }</span>

                <span class="cov0" title="0">veterinarians = append(veterinarians, &amp;vet)</span>
        }

        <span class="cov0" title="0">return veterinarians, nil</span>
}

// GetSpecializationsByVetID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
func (d *Database) GetSpecializationsByVetID(vetID int) ([]*models.Specialization, error) <span class="cov0" title="0">{
        query := `
                SELECT s.id, s.name, s.description, s.created_at
                FROM specializations s
                INNER JOIN vet_specializations vs ON s.id = vs.specialization_id
                WHERE vs.vet_id = $1
                ORDER BY s.name`

        rows, err := d.db.Query(query, vetID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var specializations []*models.Specialization
        for rows.Next() </span><span class="cov0" title="0">{
                var spec models.Specialization
                err := rows.Scan(&amp;spec.ID, &amp;spec.Name, &amp;spec.Description, &amp;spec.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov0" title="0">specializations = append(specializations, &amp;spec)</span>
        }

        <span class="cov0" title="0">return specializations, nil</span>
}

// GetAllClinics –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∫–ª–∏–Ω–∏–∫–∏
func (d *Database) GetAllClinics() ([]*models.Clinic, error) <span class="cov0" title="0">{
        query := "SELECT id, name, address, phone, working_hours, is_active, created_at FROM clinics ORDER BY name"
        rows, err := d.db.Query(query)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var clinics []*models.Clinic
        for rows.Next() </span><span class="cov0" title="0">{
                var clinic models.Clinic
                err := rows.Scan(&amp;clinic.ID, &amp;clinic.Name, &amp;clinic.Address, &amp;clinic.Phone,
                        &amp;clinic.WorkingHours, &amp;clinic.IsActive, &amp;clinic.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov0" title="0">clinics = append(clinics, &amp;clinic)</span>
        }

        <span class="cov0" title="0">return clinics, nil</span>
}

// GetSchedulesByVetID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–∞—á–∞
func (d *Database) GetSchedulesByVetID(vetID int) ([]*models.Schedule, error) <span class="cov0" title="0">{
        query := `
                SELECT s.id, s.vet_id, s.clinic_id, s.day_of_week, s.start_time, s.end_time, 
                       s.is_available, s.created_at,
                       c.name, c.address, c.phone, c.working_hours, c.is_active, c.created_at
                FROM schedules s
                LEFT JOIN clinics c ON s.clinic_id = c.id
                WHERE s.vet_id = $1 AND s.is_available = true
                ORDER BY s.day_of_week, s.start_time`

        rows, err := d.db.Query(query, vetID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var schedules []*models.Schedule
        for rows.Next() </span><span class="cov0" title="0">{
                var schedule models.Schedule
                var clinic models.Clinic
                var clinicPhone, clinicWorkingHours sql.NullString

                err := rows.Scan(&amp;schedule.ID, &amp;schedule.VetID, &amp;schedule.ClinicID, &amp;schedule.DayOfWeek,
                        &amp;schedule.StartTime, &amp;schedule.EndTime, &amp;schedule.IsAvailable, &amp;schedule.CreatedAt,
                        &amp;clinic.Name, &amp;clinic.Address, &amp;clinicPhone, &amp;clinicWorkingHours, &amp;clinic.IsActive, &amp;clinic.CreatedAt)

                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                <span class="cov0" title="0">clinic.Phone = clinicPhone
                clinic.WorkingHours = clinicWorkingHours
                schedule.Clinic = &amp;clinic
                schedules = append(schedules, &amp;schedule)</span>
        }

        <span class="cov0" title="0">return schedules, nil</span>
}

// FindAvailableVets –∏—â–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—á–µ–π –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
func (d *Database) FindAvailableVets(criteria *models.SearchCriteria) ([]*models.Veterinarian, error) <span class="cov0" title="0">{
        query := `
                SELECT DISTINCT v.id, v.first_name, v.last_name, v.phone, v.email, 
                       v.description, v.experience_years, v.is_active, v.created_at
                FROM veterinarians v
                LEFT JOIN vet_specializations vs ON v.id = vs.vet_id
                LEFT JOIN schedules s ON v.id = s.vet_id
                WHERE v.is_active = true AND s.is_available = true`

        args := []interface{}{}
        argCount := 0

        if criteria.SpecializationID &gt; 0 </span><span class="cov0" title="0">{
                argCount++
                query += fmt.Sprintf(" AND vs.specialization_id = $%d", argCount)
                args = append(args, criteria.SpecializationID)
        }</span>

        <span class="cov0" title="0">if criteria.DayOfWeek &gt; 0 </span><span class="cov0" title="0">{
                argCount++
                query += fmt.Sprintf(" AND s.day_of_week = $%d", argCount)
                args = append(args, criteria.DayOfWeek)
        }</span>

        <span class="cov0" title="0">if criteria.ClinicID &gt; 0 </span><span class="cov0" title="0">{
                argCount++
                query += fmt.Sprintf(" AND s.clinic_id = $%d", argCount)
                args = append(args, criteria.ClinicID)
        }</span>

        <span class="cov0" title="0">query += " ORDER BY v.first_name, v.last_name"

        rows, err := d.db.Query(query, args...)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var veterinarians []*models.Veterinarian
        for rows.Next() </span><span class="cov0" title="0">{
                var vet models.Veterinarian
                err := rows.Scan(&amp;vet.ID, &amp;vet.FirstName, &amp;vet.LastName, &amp;vet.Phone, &amp;vet.Email,
                        &amp;vet.Description, &amp;vet.ExperienceYears, &amp;vet.IsActive, &amp;vet.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–∞—á–∞
                <span class="cov0" title="0">specs, err := d.GetSpecializationsByVetID(vet.ID)
                if err == nil </span><span class="cov0" title="0">{
                        vet.Specializations = specs
                }</span>

                <span class="cov0" title="0">veterinarians = append(veterinarians, &amp;vet)</span>
        }

        <span class="cov0" title="0">return veterinarians, nil</span>
}

// ========== –ù–û–í–´–ï –ú–ï–¢–û–î–´ –î–õ–Ø –ê–î–ú–ò–ù–ö–ò ==========

// GetAllVeterinarians –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ—Ö –≤—Ä–∞—á–µ–π
func (d *Database) GetAllVeterinarians() ([]*models.Veterinarian, error) <span class="cov0" title="0">{
        query := `SELECT id, first_name, last_name, phone, email, description, experience_years, is_active, created_at 
              FROM veterinarians ORDER BY first_name, last_name`

        rows, err := d.db.Query(query)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()

        var vets []*models.Veterinarian
        for rows.Next() </span><span class="cov0" title="0">{
                var vet models.Veterinarian
                err := rows.Scan(&amp;vet.ID, &amp;vet.FirstName, &amp;vet.LastName, &amp;vet.Phone, &amp;vet.Email,
                        &amp;vet.Description, &amp;vet.ExperienceYears, &amp;vet.IsActive, &amp;vet.CreatedAt)
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov0" title="0">vets = append(vets, &amp;vet)</span>
        }

        <span class="cov0" title="0">return vets, nil</span>
}

// GetVeterinarianByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–∞—á–∞ –ø–æ ID
func (d *Database) GetVeterinarianByID(id int) (*models.Veterinarian, error) <span class="cov0" title="0">{
        query := `SELECT id, first_name, last_name, phone, email, description, experience_years, is_active, created_at 
              FROM veterinarians WHERE id = $1`

        var vet models.Veterinarian
        err := d.db.QueryRow(query, id).Scan(&amp;vet.ID, &amp;vet.FirstName, &amp;vet.LastName, &amp;vet.Phone,
                &amp;vet.Email, &amp;vet.Description, &amp;vet.ExperienceYears,
                &amp;vet.IsActive, &amp;vet.CreatedAt)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return &amp;vet, nil</span>
}

// GetClinicByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–Ω–∏–∫—É –ø–æ ID
func (d *Database) GetClinicByID(id int) (*models.Clinic, error) <span class="cov0" title="0">{
        query := `SELECT id, name, address, phone, working_hours, is_active, created_at 
              FROM clinics WHERE id = $1`

        var clinic models.Clinic
        err := d.db.QueryRow(query, id).Scan(&amp;clinic.ID, &amp;clinic.Name, &amp;clinic.Address,
                &amp;clinic.Phone, &amp;clinic.WorkingHours, &amp;clinic.IsActive,
                &amp;clinic.CreatedAt)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return &amp;clinic, nil</span>
}

func (d *Database) AddMissingColumns() error <span class="cov0" title="0">{
        // –î–æ–±–∞–≤–ª—è–µ–º is_active –≤ clinics –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        _, err := d.db.Exec(`
                DO $$ 
                BEGIN 
                        IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                                                  WHERE table_name = 'clinics' AND column_name = 'is_active') THEN
                                ALTER TABLE clinics ADD COLUMN is_active BOOLEAN DEFAULT TRUE;
                        END IF;
                END $$;
        `)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –î–æ–±–∞–≤–ª—è–µ–º is_active –≤ veterinarians –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        <span class="cov0" title="0">_, err = d.db.Exec(`
                DO $$ 
                BEGIN 
                        IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                                                  WHERE table_name = 'veterinarians' AND column_name = 'is_active') THEN
                                ALTER TABLE veterinarians ADD COLUMN is_active BOOLEAN DEFAULT TRUE;
                        END IF;
                END $$;
        `)
        return err</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package database

import (
        "database/sql"
        "fmt"
        "log"
        "os"

        "github.com/drerr0r/vetbot/internal/models"
)

// TestConfig —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
type TestConfig struct {
        DatabaseURL string
        UseTestDB   bool
}

// GetTestConfig –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤
func GetTestConfig() *TestConfig <span class="cov8" title="1">{
        return &amp;TestConfig{
                DatabaseURL: getTestDatabaseURL(),
                UseTestDB:   os.Getenv("USE_TEST_DB") == "true",
        }
}</span>

func getTestDatabaseURL() string <span class="cov8" title="1">{
        if url := os.Getenv("TEST_DATABASE_URL"); url != "" </span><span class="cov0" title="0">{
                return url
        }</span>
        <span class="cov8" title="1">return "postgres://vetbot_user:vetbot_password@localhost:5432/vetbot_test?sslmode=disable"</span>
}

// SetupTestDatabase —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
func SetupTestDatabase(t testingT, config *TestConfig) *Database <span class="cov8" title="1">{
        if !config.UseTestDB </span><span class="cov8" title="1">{
                t.Skip("Skipping database test - set USE_TEST_DB=true to enable")
                return nil
        }</span>

        <span class="cov0" title="0">db, err := New(config.DatabaseURL)
        if err != nil </span><span class="cov0" title="0">{
                t.Skipf("Skipping test: cannot connect to database: %v", err)
                return nil
        }</span>

        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        <span class="cov0" title="0">if err := createTestTables(db.GetDB()); err != nil </span><span class="cov0" title="0">{
                t.Fatalf("Failed to setup test database: %v", err)
        }</span>

        <span class="cov0" title="0">return db</span>
}

// testingT —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è testing.T
type testingT interface {
        Skip(args ...interface{})
        Skipf(format string, args ...interface{})
        Fatalf(format string, args ...interface{})
}

// createTestTables —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
func createTestTables(db *sql.DB) error <span class="cov0" title="0">{
        queries := []string{
                // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                `CREATE TABLE IF NOT EXISTS users (
                        id SERIAL PRIMARY KEY,
                        telegram_id BIGINT UNIQUE NOT NULL,
                        username TEXT,
                        first_name TEXT,
                        last_name TEXT,
                        phone TEXT,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )`,

                // –¢–∞–±–ª–∏—Ü–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
                `CREATE TABLE IF NOT EXISTS specializations (
                        id SERIAL PRIMARY KEY,
                        name TEXT NOT NULL,
                        description TEXT,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )`,

                // –¢–∞–±–ª–∏—Ü–∞ –≤—Ä–∞—á–µ–π
                `CREATE TABLE IF NOT EXISTS veterinarians (
                        id SERIAL PRIMARY KEY,
                        first_name TEXT NOT NULL,
                        last_name TEXT NOT NULL,
                        phone TEXT NOT NULL,
                        email TEXT,
                        description TEXT,
                        experience_years INTEGER,
                        is_active BOOLEAN DEFAULT TRUE,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )`,

                // –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–Ω–∏–∫
                `CREATE TABLE IF NOT EXISTS clinics (
                        id SERIAL PRIMARY KEY,
                        name TEXT NOT NULL,
                        address TEXT NOT NULL,
                        phone TEXT,
                        working_hours TEXT,
                        is_active BOOLEAN DEFAULT TRUE,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )`,

                // –¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–µ–π –≤—Ä–∞—á–µ–π –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
                `CREATE TABLE IF NOT EXISTS vet_specializations (
                        vet_id INTEGER REFERENCES veterinarians(id),
                        specialization_id INTEGER REFERENCES specializations(id),
                        PRIMARY KEY (vet_id, specialization_id)
                )`,

                // –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
                `CREATE TABLE IF NOT EXISTS schedules (
                        id SERIAL PRIMARY KEY,
                        vet_id INTEGER REFERENCES veterinarians(id),
                        clinic_id INTEGER REFERENCES clinics(id),
                        day_of_week INTEGER NOT NULL,
                        start_time TEXT NOT NULL,
                        end_time TEXT NOT NULL,
                        is_available BOOLEAN DEFAULT TRUE,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )`,

                // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                `INSERT INTO specializations (id, name, description) VALUES 
                        (1, '–•–∏—Ä—É—Ä–≥', '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π —Ö–∏—Ä—É—Ä–≥'),
                        (2, '–¢–µ—Ä–∞–ø–µ–≤—Ç', '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π —Ç–µ—Ä–∞–ø–µ–≤—Ç'),
                        (3, '–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥', '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π –¥–µ—Ä–º–∞—Ç–æ–ª–æ–≥')
                ON CONFLICT (id) DO NOTHING`,

                `INSERT INTO veterinarians (id, first_name, last_name, phone, is_active) VALUES 
                        (1, '–ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤', '+79123456789', true),
                        (2, '–ê–Ω–Ω–∞', '–°–º–∏—Ä–Ω–æ–≤–∞', '+79123456780', true)
                ON CONFLICT (id) DO NOTHING`,

                `INSERT INTO clinics (id, name, address, is_active) VALUES 
                        (1, '–í–µ—Ç–ö–ª–∏–Ω–∏–∫–∞ –¶–µ–Ω—Ç—Ä', '—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 1', true),
                        (2, '–í–µ—Ç–ö–ª–∏–Ω–∏–∫–∞ –°–µ–≤–µ—Ä', '—É–ª. –°–µ–≤–µ—Ä–Ω–∞—è, 2', true)
                ON CONFLICT (id) DO NOTHING`,

                `INSERT INTO vet_specializations (vet_id, specialization_id) VALUES 
                        (1, 1), (1, 2), (2, 3)
                ON CONFLICT DO NOTHING`,

                `INSERT INTO schedules (vet_id, clinic_id, day_of_week, start_time, end_time) VALUES 
                        (1, 1, 1, '09:00', '18:00'),
                        (1, 1, 3, '09:00', '18:00'),
                        (2, 2, 2, '10:00', '19:00')
                ON CONFLICT DO NOTHING`,
        }

        for _, query := range queries </span><span class="cov0" title="0">{
                if _, err := db.Exec(query); err != nil </span><span class="cov0" title="0">{
                        return fmt.Errorf("failed to execute query: %v\nQuery: %s", err, query)
                }</span>
        }

        <span class="cov0" title="0">return nil</span>
}

// CleanupTestDatabase –æ—á–∏—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
func CleanupTestDatabase(db *Database) <span class="cov0" title="0">{
        if db == nil </span><span class="cov0" title="0">{
                return
        }</span>

        <span class="cov0" title="0">queries := []string{
                "DELETE FROM schedules",
                "DELETE FROM vet_specializations",
                "DELETE FROM veterinarians",
                "DELETE FROM clinics",
                "DELETE FROM specializations",
                "DELETE FROM users",
        }

        for _, query := range queries </span><span class="cov0" title="0">{
                if _, err := db.GetDB().Exec(query); err != nil </span><span class="cov0" title="0">{
                        log.Printf("Warning: failed to cleanup: %v", err)
                }</span>
        }
}

// CreateTestUser —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
func CreateTestUser(db *Database, telegramID int64) (*models.User, error) <span class="cov0" title="0">{
        user := &amp;models.User{
                TelegramID: telegramID,
                Username:   fmt.Sprintf("testuser_%d", telegramID),
                FirstName:  "Test",
                LastName:   "User",
                Phone:      "+79123456789",
        }

        err := db.CreateUser(user)
        return user, err
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package handlers

import (
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// TelegramBotAdapter –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ tgbotapi.BotAPI
type TelegramBotAdapter struct {
        bot *tgbotapi.BotAPI
}

// NewTelegramBotAdapter —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∞–¥–∞–ø—Ç–µ—Ä
func NewTelegramBotAdapter(bot *tgbotapi.BotAPI) *TelegramBotAdapter <span class="cov0" title="0">{
        return &amp;TelegramBotAdapter{bot: bot}
}</span>

// Send –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
func (a *TelegramBotAdapter) Send(c tgbotapi.Chattable) (tgbotapi.Message, error) <span class="cov0" title="0">{
        return a.bot.Send(c)
}</span>

// Request –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
func (a *TelegramBotAdapter) Request(c tgbotapi.Chattable) (*tgbotapi.APIResponse, error) <span class="cov0" title="0">{
        return a.bot.Request(c)
}</span>
</pre>
		
		<pre class="file" id="file4" style="display: none">package handlers

import (
        "fmt"
        "log"
        "sort"
        "strconv"
        "strings"

        "github.com/drerr0r/vetbot/internal/models"
        "github.com/drerr0r/vetbot/pkg/utils"
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// AdminHandlers —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
type AdminHandlers struct {
        bot        BotAPI   // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        db         Database // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        config     *utils.Config
        adminState map[int64]string
        tempData   map[string]interface{} // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ –ø–æ–ª–µ
}

// NewAdminHandlers —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä AdminHandlers
func NewAdminHandlers(bot BotAPI, db Database, config *utils.Config) *AdminHandlers <span class="cov8" title="1">{
        return &amp;AdminHandlers{
                bot:        bot,
                db:         db,
                config:     config,
                adminState: make(map[int64]string),
                tempData:   make(map[string]interface{}), // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
        }
}</span>

// HandleAdmin –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å
func (h *AdminHandlers) HandleAdmin(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "main_menu"

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—á–∞–º–∏"),
                        tgbotapi.NewKeyboardButton("üè• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∞–º–∏"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
                        tgbotapi.NewKeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚ùå –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏"),
                ),
        )
        keyboard.OneTimeKeyboard = true

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                "üîß *–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å*\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)
}</span>

// HandleAdminMessage –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º —Ä–µ–∂–∏–º–µ
func (h *AdminHandlers) HandleAdminMessage(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        text := update.Message.Text
        state := h.adminState[userID]

        log.Printf("Admin message from %d: %s (state: %s)", userID, text, state)

        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        if text == "üîô –ù–∞–∑–∞–¥" </span><span class="cov0" title="0">{
                h.handleBackButton(update)
                return
        }</span>

        <span class="cov0" title="0">switch state </span>{
        case "main_menu":<span class="cov0" title="0">
                h.handleMainMenu(update, text)</span>
        case "vet_management":<span class="cov0" title="0">
                h.handleVetManagement(update, text)</span>
        case "clinic_management":<span class="cov0" title="0">
                h.handleClinicManagement(update, text)</span>
        case "add_vet_name":<span class="cov0" title="0">
                h.handleAddVetName(update, text)</span>
        case "add_vet_phone":<span class="cov0" title="0">
                h.handleAddVetPhone(update, text)</span>
        case "add_vet_specializations":<span class="cov0" title="0">
                h.handleAddVetSpecializations(update, text)</span>
        case "vet_list":<span class="cov0" title="0">
                h.handleVetListSelection(update, text)</span>
        case "vet_edit_menu":<span class="cov0" title="0">
                h.handleVetEditMenu(update, text)</span>
        case "vet_edit_field":<span class="cov0" title="0">
                h.handleVetEditField(update, text)</span>
        case "vet_edit_specializations":<span class="cov0" title="0">
                h.handleVetEditSpecializations(update, text)</span>
        case "vet_confirm_delete":<span class="cov0" title="0">
                h.handleVetConfirmDelete(update, text)</span>
        case "vet_toggle_active":<span class="cov0" title="0">
                h.handleVetToggleActive(update, text)</span>
        case "clinic_list":<span class="cov0" title="0">
                h.handleClinicListSelection(update, text)</span>
        case "clinic_edit_menu":<span class="cov0" title="0">
                h.handleClinicEditMenu(update, text)</span>
        case "clinic_edit_field":<span class="cov0" title="0">
                h.handleClinicEditField(update, text)</span>
        case "clinic_confirm_delete":<span class="cov0" title="0">
                h.handleClinicConfirmDelete(update, text)</span>
        case "clinic_toggle_active":<span class="cov0" title="0">
                h.handleClinicToggleActive(update, text)</span>
        default:<span class="cov0" title="0">
                h.handleMainMenu(update, text)</span>
        }
}

// handleBackButton –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
func (h *AdminHandlers) handleBackButton(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        currentState := h.adminState[userID]

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ
        switch currentState </span>{
        case "vet_management", "clinic_management":<span class="cov0" title="0">
                // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø–æ–¥–º–µ–Ω—é –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                h.adminState[userID] = "main_menu"
                h.HandleAdmin(update)</span>
        case "vet_list", "vet_edit_menu", "vet_edit_field", "vet_edit_specializations", "vet_confirm_delete", "vet_toggle_active":<span class="cov0" title="0">
                // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤—Ä–∞—á–∞–º–∏ –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏
                h.adminState[userID] = "vet_management"
                h.showVetManagement(update)</span>
        case "clinic_list", "clinic_edit_menu", "clinic_edit_field", "clinic_confirm_delete", "clinic_toggle_active":<span class="cov0" title="0">
                // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–ª–∏–Ω–∏–∫–∞–º–∏ –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∞–º–∏
                h.adminState[userID] = "clinic_management"
                h.showClinicManagement(update)</span>
        case "add_vet_name", "add_vet_phone", "add_vet_specializations":<span class="cov0" title="0">
                // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞ –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏
                h.adminState[userID] = "vet_management"
                h.cleanTempData(userID)
                h.showVetManagement(update)</span>
        default:<span class="cov0" title="0">
                // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                h.adminState[userID] = "main_menu"
                h.HandleAdmin(update)</span>
        }
}

// cleanTempData –æ—á–∏—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
func (h *AdminHandlers) cleanTempData(userID int64) <span class="cov0" title="0">{
        userIDStr := strconv.FormatInt(userID, 10)
        delete(h.tempData, userIDStr+"_name")
        delete(h.tempData, userIDStr+"_phone")
        delete(h.tempData, userIDStr+"_vet_edit")
        delete(h.tempData, userIDStr+"_clinic_edit")
}</span>

// handleMainMenu –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∫–∏
func (h *AdminHandlers) handleMainMenu(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        switch text </span>{
        case "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—á–∞–º–∏":<span class="cov0" title="0">
                h.showVetManagement(update)</span>
        case "üè• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∞–º–∏":<span class="cov0" title="0">
                h.showClinicManagement(update)</span>
        case "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":<span class="cov0" title="0">
                h.HandleStats(update)</span>
        case "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏":<span class="cov0" title="0">
                h.showSettings(update)</span>
        case "‚ùå –í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏":<span class="cov0" title="0">
                h.closeAdmin(update)</span>
        default:<span class="cov0" title="0">
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏")
                h.bot.Send(msg)</span>
        }
}

// handleVetManagement –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏
func (h *AdminHandlers) handleVetManagement(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        switch text </span>{
        case "‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–∞—á–∞":<span class="cov0" title="0">
                h.startAddVet(update)</span>
        case "üìã –°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π":<span class="cov0" title="0">
                h.showVetList(update)</span>
        case "üîô –ù–∞–∑–∞–¥":<span class="cov0" title="0">
                h.handleBackButton(update)</span>
        default:<span class="cov0" title="0">
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏")
                h.bot.Send(msg)</span>
        }
}

// handleClinicManagement –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∞–º–∏
func (h *AdminHandlers) handleClinicManagement(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        switch text </span>{
        case "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–Ω–∏–∫—É":<span class="cov0" title="0">
                h.startAddClinic(update)</span>
        case "üìã –°–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫":<span class="cov0" title="0">
                h.showClinicList(update)</span>
        case "üîô –ù–∞–∑–∞–¥":<span class="cov0" title="0">
                h.handleBackButton(update)</span>
        default:<span class="cov0" title="0">
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∞–º–∏")
                h.bot.Send(msg)</span>
        }
}

// showVetManagement –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏
func (h *AdminHandlers) showVetManagement(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "vet_management"

        // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Ä–∞—á–µ–π
        activeVets, _ := h.getActiveVetCount()
        totalVets, _ := h.getTotalVetCount()

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–∞—á–∞"),
                        tgbotapi.NewKeyboardButton("üìã –°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                fmt.Sprintf("üë• *–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—á–∞–º–∏*\n\n–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤—Ä–∞—á–µ–π: %d/%d\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", activeVets, totalVets))
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)
}</span>

// showClinicManagement –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∞–º–∏
func (h *AdminHandlers) showClinicManagement(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "clinic_management"

        // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∏–Ω–∏–∫
        activeClinics, _ := h.getActiveClinicCount()
        totalClinics, _ := h.getTotalClinicCount()

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–Ω–∏–∫—É"),
                        tgbotapi.NewKeyboardButton("üìã –°–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                fmt.Sprintf("üè• *–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∞–º–∏*\n\n–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–Ω–∏–∫: %d/%d\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", activeClinics, totalClinics))
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)
}</span>

// startAddVet –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞
func (h *AdminHandlers) startAddVet(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "add_vet_name"

        removeKeyboard := tgbotapi.NewRemoveKeyboard(true)
        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                "üë®‚Äç‚öïÔ∏è *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤—Ä–∞—á–∞*\n\n–í–≤–µ–¥–∏—Ç–µ –∏–º—è –≤—Ä–∞—á–∞:")
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = removeKeyboard

        h.bot.Send(msg)
}</span>

// handleAddVetName –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –∏–º–µ–Ω–∏ –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleAddVetName(update tgbotapi.Update, name string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "add_vet_phone"

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        userIDStr := strconv.FormatInt(userID, 10)
        h.tempData[userIDStr+"_name"] = name

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                "üìû –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –≤—Ä–∞—á–∞:")
        msg.ParseMode = "Markdown"

        h.bot.Send(msg)
}</span>

// handleAddVetPhone –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleAddVetPhone(update tgbotapi.Update, phone string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "add_vet_specializations"

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
        userIDStr := strconv.FormatInt(userID, 10)
        h.tempData[userIDStr+"_phone"] = phone

        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞
        specializations, err := h.db.GetAllSpecializations()
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π")
                h.bot.Send(msg)
                return
        }</span>

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ ID –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏
        <span class="cov0" title="0">sort.Slice(specializations, func(i, j int) bool </span><span class="cov0" title="0">{
                return specializations[i].ID &lt; specializations[j].ID
        }</span>)

        <span class="cov0" title="0">var sb strings.Builder
        sb.WriteString("üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞ (–≤–≤–µ–¥–∏—Ç–µ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):\n\n")

        for _, spec := range specializations </span><span class="cov0" title="0">{
                sb.WriteString(fmt.Sprintf("ID %d: %s\n", spec.ID, spec.Name))
        }</span>

        <span class="cov0" title="0">sb.WriteString("\n–ü—Ä–∏–º–µ—Ä: 1,3,5")

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
        h.bot.Send(msg)</span>
}

// handleAddVetSpecializations –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
func (h *AdminHandlers) handleAddVetSpecializations(update tgbotapi.Update, specsText string) <span class="cov0" title="0">{
        userID := update.Message.From.ID

        // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        userIDStr := strconv.FormatInt(userID, 10)
        name := h.getStringTempData(userIDStr + "_name")
        phone := h.getStringTempData(userIDStr + "_phone")

        if name == "" || phone == "" </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
                h.bot.Send(msg)
                h.startAddVet(update)
                return
        }</span>

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
        <span class="cov0" title="0">if !h.isValidSpecializationIDs(specsText) </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π. –í–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1,3,5)")
                h.bot.Send(msg)
                return
        }</span>

        // –°–æ–∑–¥–∞–µ–º –≤—Ä–∞—á–∞
        <span class="cov0" title="0">vet := &amp;models.Veterinarian{
                FirstName: name,
                LastName:  "", // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è —Ñ–∞–º–∏–ª–∏–∏
                Phone:     phone,
                IsActive:  true,
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞—á–∞ –≤ –±–∞–∑—É
        err := h.addVeterinarian(vet, specsText)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤—Ä–∞—á–∞: %v", err))
                h.bot.Send(msg)
        }</span> else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "‚úÖ –í—Ä–∞—á —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!")
                h.bot.Send(msg)
        }</span>

        // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        <span class="cov0" title="0">h.cleanTempData(userID)

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞–º–∏
        h.adminState[userID] = "vet_management"
        h.showVetManagement(update)</span>
}

// showVetList –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–±–æ—Ä–∞
func (h *AdminHandlers) showVetList(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "vet_list"

        vets, err := h.db.GetAllVeterinarians()
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">if len(vets) == 0 </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í—Ä–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">var sb strings.Builder
        sb.WriteString("üë• *–°–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π:*\n\n")

        for i, vet := range vets </span><span class="cov0" title="0">{
                status := "‚úÖ"
                if !vet.IsActive </span><span class="cov0" title="0">{
                        status = "‚ùå"
                }</span>
                <span class="cov0" title="0">sb.WriteString(fmt.Sprintf("%s %d. %s %s - %s\n", status, i+1, vet.FirstName, vet.LastName, vet.Phone))</span>
        }

        <span class="cov0" title="0">sb.WriteString("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤—Ä–∞—á–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)</span>
}

// handleVetListSelection –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≤—Ä–∞—á–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
func (h *AdminHandlers) handleVetListSelection(update tgbotapi.Update, text string) <span class="cov0" title="0">{

        // –ü–∞—Ä—Å–∏–º –Ω–æ–º–µ—Ä –≤—Ä–∞—á–∞
        index, err := strconv.Atoi(text)
        if err != nil || index &lt; 1 </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –≤—Ä–∞—á–∞")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">vets, err := h.db.GetAllVeterinarians()
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">if index &gt; len(vets) </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í—Ä–∞—á —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">vet := vets[index-1]
        h.showVetEditMenu(update, vet)</span>
}

// showVetEditMenu –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–∞—á–∞
func (h *AdminHandlers) showVetEditMenu(update tgbotapi.Update, vet *models.Veterinarian) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "vet_edit_menu"

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤—Ä–∞—á–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        userIDStr := strconv.FormatInt(userID, 10)
        h.tempData[userIDStr+"_vet_edit"] = &amp;models.VetEditData{
                VetID: vet.ID,
        }

        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
        specs, err := h.db.GetSpecializationsByVetID(vet.ID)
        specsText := ""
        if err == nil &amp;&amp; len(specs) &gt; 0 </span><span class="cov0" title="0">{
                var specIDs []string
                for _, spec := range specs </span><span class="cov0" title="0">{
                        specIDs = append(specIDs, strconv.Itoa(spec.ID))
                }</span>
                <span class="cov0" title="0">specsText = strings.Join(specIDs, ",")</span>
        }

        <span class="cov0" title="0">var sb strings.Builder
        sb.WriteString(fmt.Sprintf("üë®‚Äç‚öïÔ∏è *–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—á–æ–º:* %s %s\n\n", vet.FirstName, vet.LastName))
        sb.WriteString(fmt.Sprintf("üìû –¢–µ–ª–µ—Ñ–æ–Ω: %s\n", vet.Phone))

        if vet.Email.Valid </span><span class="cov0" title="0">{
                sb.WriteString(fmt.Sprintf("üìß Email: %s\n", vet.Email.String))
        }</span>

        <span class="cov0" title="0">if vet.ExperienceYears.Valid </span><span class="cov0" title="0">{
                sb.WriteString(fmt.Sprintf("üíº –û–ø—ã—Ç: %d –ª–µ—Ç\n", vet.ExperienceYears.Int64))
        }</span>

        <span class="cov0" title="0">sb.WriteString("üìä –°—Ç–∞—Ç—É—Å: ")
        if vet.IsActive </span><span class="cov0" title="0">{
                sb.WriteString("‚úÖ –ê–∫—Ç–∏–≤–µ–Ω\n")
        }</span> else<span class="cov0" title="0"> {
                sb.WriteString("‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω\n")
        }</span>

        <span class="cov0" title="0">sb.WriteString(fmt.Sprintf("üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: %s\n\n", specsText))
        sb.WriteString("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º—è"),
                        tgbotapi.NewKeyboardButton("üìû –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üéØ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏"),
                        tgbotapi.NewKeyboardButton("üìß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å email"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üíº –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—ã—Ç"),
                        tgbotapi.NewKeyboardButton("‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Ä–∞—á–∞"),
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)</span>
}

// handleVetEditMenu –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleVetEditMenu(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        vetData, ok := h.tempData[userIDStr+"_vet_edit"].(*models.VetEditData)
        if !ok || vetData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞
        <span class="cov0" title="0">vet, err := h.db.GetVeterinarianByID(vetData.VetID)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–∞—á–∞")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        <span class="cov0" title="0">switch text </span>{
        case "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º—è":<span class="cov0" title="0">
                h.adminState[userID] = "vet_edit_field"
                vetData.Field = "first_name"
                vetData.CurrentValue = vet.FirstName
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –≤—Ä–∞—á–∞:")
                h.bot.Send(msg)</span>

        case "üìû –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω":<span class="cov0" title="0">
                h.adminState[userID] = "vet_edit_field"
                vetData.Field = "phone"
                vetData.CurrentValue = vet.Phone
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –≤—Ä–∞—á–∞:")
                h.bot.Send(msg)</span>

        case "üìß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å email":<span class="cov0" title="0">
                h.adminState[userID] = "vet_edit_field"
                vetData.Field = "email"
                if vet.Email.Valid </span><span class="cov0" title="0">{
                        vetData.CurrentValue = vet.Email.String
                }</span>
                <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π email –≤—Ä–∞—á–∞ (–∏–ª–∏ '-' –¥–ª—è –æ—á–∏—Å—Ç–∫–∏):")
                h.bot.Send(msg)</span>

        case "üíº –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—ã—Ç":<span class="cov0" title="0">
                h.adminState[userID] = "vet_edit_field"
                vetData.Field = "experience_years"
                if vet.ExperienceYears.Valid </span><span class="cov0" title="0">{
                        vetData.CurrentValue = strconv.FormatInt(vet.ExperienceYears.Int64, 10)
                }</span>
                <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –≥–æ–¥–∞—Ö (–∏–ª–∏ '-' –¥–ª—è –æ—á–∏—Å—Ç–∫–∏):")
                h.bot.Send(msg)</span>

        case "üéØ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏":<span class="cov0" title="0">
                h.adminState[userID] = "vet_edit_specializations"
                specs, err := h.db.GetSpecializationsByVetID(vet.ID)
                if err == nil &amp;&amp; len(specs) &gt; 0 </span><span class="cov0" title="0">{
                        var specIDs []string
                        for _, spec := range specs </span><span class="cov0" title="0">{
                                specIDs = append(specIDs, strconv.Itoa(spec.ID))
                        }</span>
                        <span class="cov0" title="0">vetData.Specializations = strings.Join(specIDs, ",")</span>
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
                <span class="cov0" title="0">specializations, err := h.db.GetAllSpecializations()
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π")
                        h.bot.Send(msg)
                        return
                }</span>

                <span class="cov0" title="0">var sb strings.Builder
                sb.WriteString("üéØ –¢–µ–∫—É—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ")
                if vetData.Specializations != "" </span><span class="cov0" title="0">{
                        sb.WriteString(vetData.Specializations)
                }</span> else<span class="cov0" title="0"> {
                        sb.WriteString("–Ω–µ —É–∫–∞–∑–∞–Ω—ã")
                }</span>
                <span class="cov0" title="0">sb.WriteString("\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:\n")

                for _, spec := range specializations </span><span class="cov0" title="0">{
                        sb.WriteString(fmt.Sprintf("ID %d: %s\n", spec.ID, spec.Name))
                }</span>

                <span class="cov0" title="0">sb.WriteString("\n–í–≤–µ–¥–∏—Ç–µ ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1,3,5):")

                msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
                h.bot.Send(msg)</span>

        case "‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å":<span class="cov0" title="0">
                h.adminState[userID] = "vet_toggle_active"
                newStatus := !vet.IsActive
                statusText := "–∞–∫—Ç–∏–≤–µ–Ω"
                if !newStatus </span><span class="cov0" title="0">{
                        statusText = "–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"
                }</span>

                <span class="cov0" title="0">keyboard := tgbotapi.NewReplyKeyboard(
                        tgbotapi.NewKeyboardButtonRow(
                                tgbotapi.NewKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"),
                                tgbotapi.NewKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞"),
                        ),
                )

                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –≤—Ä–∞—á–∞ %s %s?", vet.FirstName, statusText))
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)</span>

        case "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Ä–∞—á–∞":<span class="cov0" title="0">
                h.adminState[userID] = "vet_confirm_delete"
                keyboard := tgbotapi.NewReplyKeyboard(
                        tgbotapi.NewKeyboardButtonRow(
                                tgbotapi.NewKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"),
                                tgbotapi.NewKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞"),
                        ),
                )

                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("‚ö†Ô∏è *–í–ù–ò–ú–ê–ù–ò–ï!* \n\n–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—Ä–∞—á–∞ %s %s.\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!\n\n–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ:", vet.FirstName, vet.LastName))
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)</span>

        case "üîô –ù–∞–∑–∞–¥":<span class="cov0" title="0">
                h.handleBackButton(update)</span>

        default:<span class="cov0" title="0">
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
                h.bot.Send(msg)</span>
        }
}

// handleVetEditField –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—è –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleVetEditField(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        vetData, ok := h.tempData[userIDStr+"_vet_edit"].(*models.VetEditData)
        if !ok || vetData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        <span class="cov0" title="0">if text == "-" </span><span class="cov0" title="0">{
                text = "" // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
        }</span>

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        <span class="cov0" title="0">err := h.updateVeterinarianField(vetData.VetID, vetData.Field, text)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: %v", err))
                h.bot.Send(msg)
        }</span> else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–∞—á–∞
        <span class="cov0" title="0">vet, err := h.db.GetVeterinarianByID(vetData.VetID)
        if err == nil </span><span class="cov0" title="0">{
                h.showVetEditMenu(update, vet)
        }</span> else<span class="cov0" title="0"> {
                h.showVetList(update)
        }</span>
}

// handleVetEditSpecializations –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleVetEditSpecializations(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        vetData, ok := h.tempData[userIDStr+"_vet_edit"].(*models.VetEditData)
        if !ok || vetData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        // –í–∞–ª–∏–¥–∞—Ü–∏—è ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
        <span class="cov0" title="0">if text != "" &amp;&amp; !h.isValidSpecializationIDs(text) </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π. –í–≤–µ–¥–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é")
                h.bot.Send(msg)
                return
        }</span>

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
        <span class="cov0" title="0">err := h.updateVeterinarianSpecializations(vetData.VetID, text)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π: %v", err))
                h.bot.Send(msg)
        }</span> else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–∞—á–∞
        <span class="cov0" title="0">vet, err := h.db.GetVeterinarianByID(vetData.VetID)
        if err == nil </span><span class="cov0" title="0">{
                h.showVetEditMenu(update, vet)
        }</span> else<span class="cov0" title="0"> {
                h.showVetList(update)
        }</span>
}

// handleVetConfirmDelete –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleVetConfirmDelete(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        vetData, ok := h.tempData[userIDStr+"_vet_edit"].(*models.VetEditData)
        if !ok || vetData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        <span class="cov0" title="0">if text == "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ" </span><span class="cov0" title="0">{
                err := h.deleteVeterinarian(vetData.VetID)
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—Ä–∞—á–∞: %v", err))
                        h.bot.Send(msg)
                }</span> else<span class="cov0" title="0"> {
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "‚úÖ –í—Ä–∞—á —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!")
                        h.bot.Send(msg)
                }</span>
        } else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ —Å–ø–∏—Å–∫—É –≤—Ä–∞—á–µ–π
        <span class="cov0" title="0">h.showVetList(update)</span>
}

// handleVetToggleActive –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Ä–∞—á–∞
func (h *AdminHandlers) handleVetToggleActive(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        vetData, ok := h.tempData[userIDStr+"_vet_edit"].(*models.VetEditData)
        if !ok || vetData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –≤—Ä–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showVetList(update)
                return
        }</span>

        <span class="cov0" title="0">if text == "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" </span><span class="cov0" title="0">{
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–∞—á–∞
                vet, err := h.db.GetVeterinarianByID(vetData.VetID)
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–∞—á–∞")
                        h.bot.Send(msg)
                        h.showVetList(update)
                        return
                }</span>

                // –ú–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
                <span class="cov0" title="0">newStatus := !vet.IsActive
                err = h.updateVeterinarianField(vetData.VetID, "is_active", strconv.FormatBool(newStatus))
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: %v", err))
                        h.bot.Send(msg)
                }</span> else<span class="cov0" title="0"> {
                        statusText := "–∞–∫—Ç–∏–≤–µ–Ω"
                        if !newStatus </span><span class="cov0" title="0">{
                                statusText = "–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"
                        }</span>
                        <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("‚úÖ –°—Ç–∞—Ç—É—Å –≤—Ä–∞—á–∞ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: %s", statusText))
                        h.bot.Send(msg)</span>
                }
        } else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–∞—á–∞
        <span class="cov0" title="0">vet, err := h.db.GetVeterinarianByID(vetData.VetID)
        if err == nil </span><span class="cov0" title="0">{
                h.showVetEditMenu(update, vet)
        }</span> else<span class="cov0" title="0"> {
                h.showVetList(update)
        }</span>
}

// showClinicList –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–±–æ—Ä–∞
func (h *AdminHandlers) showClinicList(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "clinic_list"

        clinics, err := h.db.GetAllClinics()
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–Ω–∏–∫")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">if len(clinics) == 0 </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ö–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">var sb strings.Builder
        sb.WriteString("üè• *–°–ø–∏—Å–æ–∫ –∫–ª–∏–Ω–∏–∫:*\n\n")

        for i, clinic := range clinics </span><span class="cov0" title="0">{
                status := "‚úÖ"
                if !clinic.IsActive </span><span class="cov0" title="0">{
                        status = "‚ùå"
                }</span>
                <span class="cov0" title="0">sb.WriteString(fmt.Sprintf("%s %d. %s - %s\n", status, i+1, clinic.Name, clinic.Address))</span>
        }

        <span class="cov0" title="0">sb.WriteString("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–ª–∏–Ω–∏–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)</span>
}

// handleClinicListSelection –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–ª–∏–Ω–∏–∫–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
func (h *AdminHandlers) handleClinicListSelection(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        // –ü–∞—Ä—Å–∏–º –Ω–æ–º–µ—Ä –∫–ª–∏–Ω–∏–∫–∏
        index, err := strconv.Atoi(text)
        if err != nil || index &lt; 1 </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–ª–∏–Ω–∏–∫–∏")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">clinics, err := h.db.GetAllClinics()
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–Ω–∏–∫")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">if index &gt; len(clinics) </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ö–ª–∏–Ω–∏–∫–∞ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov0" title="0">clinic := clinics[index-1]
        h.showClinicEditMenu(update, clinic)</span>
}

// showClinicEditMenu –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) showClinicEditMenu(update tgbotapi.Update, clinic *models.Clinic) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        h.adminState[userID] = "clinic_edit_menu"

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∫–ª–∏–Ω–∏–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        userIDStr := strconv.FormatInt(userID, 10)
        h.tempData[userIDStr+"_clinic_edit"] = &amp;models.ClinicEditData{
                ClinicID: clinic.ID,
        }

        var sb strings.Builder
        sb.WriteString(fmt.Sprintf("üè• *–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–æ–π:* %s\n\n", clinic.Name))
        sb.WriteString(fmt.Sprintf("üìç –ê–¥—Ä–µ—Å: %s\n", clinic.Address))

        if clinic.Phone.Valid </span><span class="cov0" title="0">{
                sb.WriteString(fmt.Sprintf("üìû –¢–µ–ª–µ—Ñ–æ–Ω: %s\n", clinic.Phone.String))
        }</span>

        <span class="cov0" title="0">if clinic.WorkingHours.Valid </span><span class="cov0" title="0">{
                sb.WriteString(fmt.Sprintf("üïê –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: %s\n", clinic.WorkingHours.String))
        }</span>

        <span class="cov0" title="0">sb.WriteString("üìä –°—Ç–∞—Ç—É—Å: ")
        if clinic.IsActive </span><span class="cov0" title="0">{
                sb.WriteString("‚úÖ –ê–∫—Ç–∏–≤–Ω–∞\n")
        }</span> else<span class="cov0" title="0"> {
                sb.WriteString("‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω–∞\n")
        }</span>

        <span class="cov0" title="0">sb.WriteString("\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:")

        keyboard := tgbotapi.NewReplyKeyboard(
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ"),
                        tgbotapi.NewKeyboardButton("üìç –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üìû –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω"),
                        tgbotapi.NewKeyboardButton("üïê –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å"),
                        tgbotapi.NewKeyboardButton("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–Ω–∏–∫—É"),
                ),
                tgbotapi.NewKeyboardButtonRow(
                        tgbotapi.NewKeyboardButton("üîô –ù–∞–∑–∞–¥"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, sb.String())
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        h.bot.Send(msg)</span>
}

// handleClinicEditMenu –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) handleClinicEditMenu(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        clinicData, ok := h.tempData[userIDStr+"_clinic_edit"].(*models.ClinicEditData)
        if !ok || clinicData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showClinicList(update)
                return
        }</span>

        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏
        <span class="cov0" title="0">clinic, err := h.db.GetClinicByID(clinicData.ClinicID)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–Ω–∏–∫–∏")
                h.bot.Send(msg)
                h.showClinicList(update)
                return
        }</span>

        <span class="cov0" title="0">switch text </span>{
        case "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_edit_field"
                clinicData.Field = "name"
                clinicData.CurrentValue = clinic.Name
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∏:")
                h.bot.Send(msg)</span>

        case "üìç –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_edit_field"
                clinicData.Field = "address"
                clinicData.CurrentValue = clinic.Address
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –∫–ª–∏–Ω–∏–∫–∏:")
                h.bot.Send(msg)</span>

        case "üìû –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_edit_field"
                clinicData.Field = "phone"
                if clinic.Phone.Valid </span><span class="cov0" title="0">{
                        clinicData.CurrentValue = clinic.Phone.String
                }</span>
                <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–Ω–∏–∫–∏ (–∏–ª–∏ '-' –¥–ª—è –æ—á–∏—Å—Ç–∫–∏):")
                h.bot.Send(msg)</span>

        case "üïê –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_edit_field"
                clinicData.Field = "working_hours"
                if clinic.WorkingHours.Valid </span><span class="cov0" title="0">{
                        clinicData.CurrentValue = clinic.WorkingHours.String
                }</span>
                <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏–∫–∏ (–∏–ª–∏ '-' –¥–ª—è –æ—á–∏—Å—Ç–∫–∏):")
                h.bot.Send(msg)</span>

        case "‚ö° –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_toggle_active"
                newStatus := !clinic.IsActive
                statusText := "–∞–∫—Ç–∏–≤–Ω–∞"
                if !newStatus </span><span class="cov0" title="0">{
                        statusText = "–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞"
                }</span>

                <span class="cov0" title="0">keyboard := tgbotapi.NewReplyKeyboard(
                        tgbotapi.NewKeyboardButtonRow(
                                tgbotapi.NewKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"),
                                tgbotapi.NewKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞"),
                        ),
                )

                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∫–ª–∏–Ω–∏–∫—É %s %s?", clinic.Name, statusText))
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)</span>

        case "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–Ω–∏–∫—É":<span class="cov0" title="0">
                h.adminState[userID] = "clinic_confirm_delete"
                keyboard := tgbotapi.NewReplyKeyboard(
                        tgbotapi.NewKeyboardButtonRow(
                                tgbotapi.NewKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"),
                                tgbotapi.NewKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞"),
                        ),
                )

                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("‚ö†Ô∏è *–í–ù–ò–ú–ê–ù–ò–ï!* \n\n–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–Ω–∏–∫—É %s.\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!\n\n–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ:", clinic.Name))
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)</span>

        case "üîô –ù–∞–∑–∞–¥":<span class="cov0" title="0">
                h.handleBackButton(update)</span>

        default:<span class="cov0" title="0">
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
                h.bot.Send(msg)</span>
        }
}

// handleClinicEditField –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—è –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) handleClinicEditField(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        clinicData, ok := h.tempData[userIDStr+"_clinic_edit"].(*models.ClinicEditData)
        if !ok || clinicData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showClinicList(update)
                return
        }</span>

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        <span class="cov0" title="0">if text == "-" </span><span class="cov0" title="0">{
                text = "" // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
        }</span>

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        <span class="cov0" title="0">err := h.updateClinicField(clinicData.ClinicID, clinicData.Field, text)
        if err != nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: %v", err))
                h.bot.Send(msg)
        }</span> else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏
        <span class="cov0" title="0">clinic, err := h.db.GetClinicByID(clinicData.ClinicID)
        if err == nil </span><span class="cov0" title="0">{
                h.showClinicEditMenu(update, clinic)
        }</span> else<span class="cov0" title="0"> {
                h.showClinicList(update)
        }</span>
}

// handleClinicConfirmDelete –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) handleClinicConfirmDelete(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        clinicData, ok := h.tempData[userIDStr+"_clinic_edit"].(*models.ClinicEditData)
        if !ok || clinicData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showClinicList(update)
                return
        }</span>

        <span class="cov0" title="0">if text == "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ" </span><span class="cov0" title="0">{
                err := h.deleteClinic(clinicData.ClinicID)
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª–∏–Ω–∏–∫–∏: %v", err))
                        h.bot.Send(msg)
                }</span> else<span class="cov0" title="0"> {
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "‚úÖ –ö–ª–∏–Ω–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!")
                        h.bot.Send(msg)
                }</span>
        } else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ —Å–ø–∏—Å–∫—É –∫–ª–∏–Ω–∏–∫
        <span class="cov0" title="0">h.showClinicList(update)</span>
}

// handleClinicToggleActive –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) handleClinicToggleActive(update tgbotapi.Update, text string) <span class="cov0" title="0">{
        userID := update.Message.From.ID
        userIDStr := strconv.FormatInt(userID, 10)

        clinicData, ok := h.tempData[userIDStr+"_clinic_edit"].(*models.ClinicEditData)
        if !ok || clinicData == nil </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                h.showClinicList(update)
                return
        }</span>

        <span class="cov0" title="0">if text == "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" </span><span class="cov0" title="0">{
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–ª–∏–Ω–∏–∫—É
                clinic, err := h.db.GetClinicByID(clinicData.ClinicID)
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–Ω–∏–∫–∏")
                        h.bot.Send(msg)
                        h.showClinicList(update)
                        return
                }</span>

                // –ú–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
                <span class="cov0" title="0">newStatus := !clinic.IsActive
                err = h.updateClinicField(clinicData.ClinicID, "is_active", strconv.FormatBool(newStatus))
                if err != nil </span><span class="cov0" title="0">{
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: %v", err))
                        h.bot.Send(msg)
                }</span> else<span class="cov0" title="0"> {
                        statusText := "–∞–∫—Ç–∏–≤–Ω–∞"
                        if !newStatus </span><span class="cov0" title="0">{
                                statusText = "–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞"
                        }</span>
                        <span class="cov0" title="0">msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                                fmt.Sprintf("‚úÖ –°—Ç–∞—Ç—É—Å –∫–ª–∏–Ω–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: %s", statusText))
                        h.bot.Send(msg)</span>
                }
        } else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ")
                h.bot.Send(msg)
        }</span>

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏
        <span class="cov0" title="0">clinic, err := h.db.GetClinicByID(clinicData.ClinicID)
        if err == nil </span><span class="cov0" title="0">{
                h.showClinicEditMenu(update, clinic)
        }</span> else<span class="cov0" title="0"> {
                h.showClinicList(update)
        }</span>
}

// startAddClinic –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏
func (h *AdminHandlers) startAddClinic(update tgbotapi.Update) <span class="cov0" title="0">{
        // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–Ω–∏–∫–∏
        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–Ω–∏–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")
        h.bot.Send(msg)
}</span>

// showSettings –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
func (h *AdminHandlers) showSettings(update tgbotapi.Update) <span class="cov0" title="0">{
        userCount, _ := h.getUserCount()
        activeVets, _ := h.getActiveVetCount()
        totalVets, _ := h.getTotalVetCount()
        activeClinics, _ := h.getActiveClinicCount()
        totalClinics, _ := h.getTotalClinicCount()

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                fmt.Sprintf(`‚öôÔ∏è *–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã*

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %d
‚Ä¢ –í—Ä–∞—á–µ–π: %d/%d –∞–∫—Ç–∏–≤–Ω—ã—Ö
‚Ä¢ –ö–ª–∏–Ω–∏–∫: %d/%d –∞–∫—Ç–∏–≤–Ω—ã—Ö

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –ø—Ä—è–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.`,
                        userCount, activeVets, totalVets, activeClinics, totalClinics))
        msg.ParseMode = "Markdown"
        h.bot.Send(msg)
}</span>

// HandleStats –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞
func (h *AdminHandlers) HandleStats(update tgbotapi.Update) <span class="cov0" title="0">{
        userCount, _ := h.getUserCount()
        activeVets, _ := h.getActiveVetCount()
        totalVets, _ := h.getTotalVetCount()
        activeClinics, _ := h.getActiveClinicCount()
        totalClinics, _ := h.getTotalClinicCount()
        requestCount, _ := h.getRequestCount()

        statsMsg := fmt.Sprintf(`üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞*

üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: %d
üë®‚Äç‚öïÔ∏è –í—Ä–∞—á–µ–π: %d/%d –∞–∫—Ç–∏–≤–Ω—ã—Ö
üè• –ö–ª–∏–Ω–∏–∫: %d/%d –∞–∫—Ç–∏–≤–Ω—ã—Ö
üìû –ó–∞–ø—Ä–æ—Å–æ–≤: %d

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ ‚úÖ`, userCount, activeVets, totalVets, activeClinics, totalClinics, requestCount)

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, statsMsg)
        msg.ParseMode = "Markdown"
        h.bot.Send(msg)
}</span>

// closeAdmin –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å
func (h *AdminHandlers) closeAdmin(update tgbotapi.Update) <span class="cov0" title="0">{
        userID := update.Message.From.ID

        // –û—á–∏—â–∞–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        h.cleanTempData(userID)
        delete(h.adminState, userID)

        removeKeyboard := tgbotapi.NewRemoveKeyboard(true)
        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–∫—Ä—ã—Ç–∞")
        msg.ReplyMarkup = removeKeyboard
        h.bot.Send(msg)
}</span>

// ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ –î–õ–Ø –†–ê–ë–û–¢–´ –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–• ==========

// isValidSpecializationIDs –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
func (h *AdminHandlers) isValidSpecializationIDs(input string) bool <span class="cov0" title="0">{
        if input == "" </span><span class="cov0" title="0">{
                return true // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–∞ (–æ—á–∏—Å—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π)
        }</span>

        // –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        <span class="cov0" title="0">maxID, err := h.getMaxSpecializationID()
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error getting max specialization ID: %v", err)
                return false
        }</span>

        <span class="cov0" title="0">ids := strings.Split(input, ",")
        for _, idStr := range ids </span><span class="cov0" title="0">{
                id, err := strconv.Atoi(strings.TrimSpace(idStr))
                if err != nil || id &lt;= 0 || id &gt; maxID </span><span class="cov0" title="0">{
                        return false
                }</span>

                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –ë–î
                <span class="cov0" title="0">exists, err := h.db.SpecializationExists(id)
                if err != nil || !exists </span><span class="cov0" title="0">{
                        return false
                }</span>
        }
        <span class="cov0" title="0">return true</span>
}

// getMaxSpecializationID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (h *AdminHandlers) getMaxSpecializationID() (int, error) <span class="cov0" title="0">{
        var maxID int
        err := h.db.GetDB().QueryRow("SELECT COALESCE(MAX(id), 0) FROM specializations").Scan(&amp;maxID)
        return maxID, err
}</span>

// addVeterinarian –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Ä–∞—á–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
func (h *AdminHandlers) addVeterinarian(vet *models.Veterinarian, specsText string) error <span class="cov0" title="0">{
        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞—á–∞ –≤ –±–∞–∑—É
        query := `INSERT INTO veterinarians (first_name, last_name, phone, is_active) 
                  VALUES ($1, $2, $3, $4) RETURNING id`

        err := h.db.GetDB().QueryRow(query, vet.FirstName, vet.LastName, vet.Phone, vet.IsActive).
                Scan(&amp;vet.ID)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        <span class="cov0" title="0">if specsText != "" </span><span class="cov0" title="0">{
                specIDs := strings.Split(specsText, ",")
                log.Printf("Adding vet ID %d with specializations: %v", vet.ID, specIDs)

                for _, specIDStr := range specIDs </span><span class="cov0" title="0">{
                        specID, err := strconv.Atoi(strings.TrimSpace(specIDStr))
                        if err == nil &amp;&amp; specID &gt; 0 </span><span class="cov0" title="0">{
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                                exists, err := h.db.SpecializationExists(specID)
                                if err != nil </span><span class="cov0" title="0">{
                                        log.Printf("Error checking specialization %d: %v", specID, err)
                                        continue</span>
                                }

                                <span class="cov0" title="0">if exists </span><span class="cov0" title="0">{
                                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å –≤—Ä–∞—á-—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                                        _, err = h.db.GetDB().Exec(
                                                "INSERT INTO vet_specializations (vet_id, specialization_id) VALUES ($1, $2)",
                                                vet.ID, specID,
                                        )
                                        if err != nil </span><span class="cov0" title="0">{
                                                log.Printf("Error adding specialization %d: %v", specID, err)
                                        }</span> else<span class="cov0" title="0"> {
                                                log.Printf("Successfully added specialization %d for vet %d", specID, vet.ID)
                                        }</span>
                                } else<span class="cov0" title="0"> {
                                        log.Printf("Specialization %d does not exist", specID)
                                }</span>
                        }
                }
        }

        <span class="cov0" title="0">return nil</span>
}

// updateVeterinarianField –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ –≤—Ä–∞—á–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
func (h *AdminHandlers) updateVeterinarianField(vetID int, field string, value string) error <span class="cov0" title="0">{
        var query string
        var err error

        switch field </span>{
        case "first_name":<span class="cov0" title="0">
                query = "UPDATE veterinarians SET first_name = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, value, vetID)</span>
        case "phone":<span class="cov0" title="0">
                query = "UPDATE veterinarians SET phone = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, value, vetID)</span>
        case "email":<span class="cov0" title="0">
                if value == "" </span><span class="cov0" title="0">{
                        query = "UPDATE veterinarians SET email = NULL WHERE id = $1"
                        _, err = h.db.GetDB().Exec(query, vetID)
                }</span> else<span class="cov0" title="0"> {
                        query = "UPDATE veterinarians SET email = $1 WHERE id = $2"
                        _, err = h.db.GetDB().Exec(query, value, vetID)
                }</span>
        case "experience_years":<span class="cov0" title="0">
                if value == "" </span><span class="cov0" title="0">{
                        query = "UPDATE veterinarians SET experience_years = NULL WHERE id = $1"
                        _, err = h.db.GetDB().Exec(query, vetID)
                }</span> else<span class="cov0" title="0"> {
                        exp, convErr := strconv.ParseInt(value, 10, 64)
                        if convErr != nil </span><span class="cov0" title="0">{
                                return convErr
                        }</span>
                        <span class="cov0" title="0">query = "UPDATE veterinarians SET experience_years = $1 WHERE id = $2"
                        _, err = h.db.GetDB().Exec(query, exp, vetID)</span>
                }
        case "is_active":<span class="cov0" title="0">
                active, convErr := strconv.ParseBool(value)
                if convErr != nil </span><span class="cov0" title="0">{
                        return convErr
                }</span>
                <span class="cov0" title="0">query = "UPDATE veterinarians SET is_active = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, active, vetID)</span>
        default:<span class="cov0" title="0">
                return fmt.Errorf("unknown field: %s", field)</span>
        }

        <span class="cov0" title="0">return err</span>
}

// updateVeterinarianSpecializations –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
func (h *AdminHandlers) updateVeterinarianSpecializations(vetID int, specsText string) error <span class="cov0" title="0">{
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
        _, err := h.db.GetDB().Exec("DELETE FROM vet_specializations WHERE vet_id = $1", vetID)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã
        <span class="cov0" title="0">if specsText != "" </span><span class="cov0" title="0">{
                specIDs := strings.Split(specsText, ",")
                for _, specIDStr := range specIDs </span><span class="cov0" title="0">{
                        specID, err := strconv.Atoi(strings.TrimSpace(specIDStr))
                        if err == nil &amp;&amp; specID &gt; 0 </span><span class="cov0" title="0">{
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                                exists, err := h.db.SpecializationExists(specID)
                                if err == nil &amp;&amp; exists </span><span class="cov0" title="0">{
                                        _, err = h.db.GetDB().Exec(
                                                "INSERT INTO vet_specializations (vet_id, specialization_id) VALUES ($1, $2)",
                                                vetID, specID,
                                        )
                                        if err != nil </span><span class="cov0" title="0">{
                                                log.Printf("Error adding specialization %d: %v", specID, err)
                                        }</span>
                                }
                        }
                }
        }

        <span class="cov0" title="0">return nil</span>
}

// deleteVeterinarian —É–¥–∞–ª—è–µ—Ç –≤—Ä–∞—á–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func (h *AdminHandlers) deleteVeterinarian(vetID int) error <span class="cov0" title="0">{
        // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∏ —Å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º–∏
        _, err := h.db.GetDB().Exec("DELETE FROM vet_specializations WHERE vet_id = $1", vetID)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –£–¥–∞–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–∞—á–∞
        <span class="cov0" title="0">_, err = h.db.GetDB().Exec("DELETE FROM schedules WHERE vet_id = $1", vetID)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –£–¥–∞–ª—è–µ–º –≤—Ä–∞—á–∞
        <span class="cov0" title="0">_, err = h.db.GetDB().Exec("DELETE FROM veterinarians WHERE id = $1", vetID)
        return err</span>
}

// updateClinicField –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ –∫–ª–∏–Ω–∏–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
func (h *AdminHandlers) updateClinicField(clinicID int, field string, value string) error <span class="cov0" title="0">{
        var query string
        var err error

        switch field </span>{
        case "name":<span class="cov0" title="0">
                query = "UPDATE clinics SET name = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, value, clinicID)</span>
        case "address":<span class="cov0" title="0">
                query = "UPDATE clinics SET address = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, value, clinicID)</span>
        case "phone":<span class="cov0" title="0">
                if value == "" </span><span class="cov0" title="0">{
                        query = "UPDATE clinics SET phone = NULL WHERE id = $1"
                        _, err = h.db.GetDB().Exec(query, clinicID)
                }</span> else<span class="cov0" title="0"> {
                        query = "UPDATE clinics SET phone = $1 WHERE id = $2"
                        _, err = h.db.GetDB().Exec(query, value, clinicID)
                }</span>
        case "working_hours":<span class="cov0" title="0">
                if value == "" </span><span class="cov0" title="0">{
                        query = "UPDATE clinics SET working_hours = NULL WHERE id = $1"
                        _, err = h.db.GetDB().Exec(query, clinicID)
                }</span> else<span class="cov0" title="0"> {
                        query = "UPDATE clinics SET working_hours = $1 WHERE id = $2"
                        _, err = h.db.GetDB().Exec(query, value, clinicID)
                }</span>
        case "is_active":<span class="cov0" title="0">
                active, convErr := strconv.ParseBool(value)
                if convErr != nil </span><span class="cov0" title="0">{
                        return convErr
                }</span>
                <span class="cov0" title="0">query = "UPDATE clinics SET is_active = $1 WHERE id = $2"
                _, err = h.db.GetDB().Exec(query, active, clinicID)</span>
        default:<span class="cov0" title="0">
                return fmt.Errorf("unknown field: %s", field)</span>
        }

        <span class="cov0" title="0">return err</span>
}

// deleteClinic —É–¥–∞–ª—è–µ—Ç –∫–ª–∏–Ω–∏–∫—É –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func (h *AdminHandlers) deleteClinic(clinicID int) error <span class="cov0" title="0">{
        // –£–¥–∞–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –∫–ª–∏–Ω–∏–∫–æ–π
        _, err := h.db.GetDB().Exec("DELETE FROM schedules WHERE clinic_id = $1", clinicID)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        // –£–¥–∞–ª—è–µ–º –∫–ª–∏–Ω–∏–∫—É
        <span class="cov0" title="0">_, err = h.db.GetDB().Exec("DELETE FROM clinics WHERE id = $1", clinicID)
        return err</span>
}

// getStringTempData –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
func (h *AdminHandlers) getStringTempData(key string) string <span class="cov0" title="0">{
        if value, exists := h.tempData[key]; exists </span><span class="cov0" title="0">{
                if str, ok := value.(string); ok </span><span class="cov0" title="0">{
                        return str
                }</span>
        }
        <span class="cov0" title="0">return ""</span>
}

// ========== –ú–ï–¢–û–î–´ –î–õ–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========

func (h *AdminHandlers) getUserCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM users"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>

func (h *AdminHandlers) getActiveVetCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM veterinarians WHERE is_active = true"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>

func (h *AdminHandlers) getTotalVetCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM veterinarians"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>

func (h *AdminHandlers) getActiveClinicCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM clinics WHERE is_active = true"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>

func (h *AdminHandlers) getTotalClinicCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM clinics"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>

func (h *AdminHandlers) getRequestCount() (int, error) <span class="cov0" title="0">{
        query := "SELECT COUNT(*) FROM user_requests"
        var count int
        err := h.db.GetDB().QueryRow(query).Scan(&amp;count)
        return count, err
}</span>
</pre>
		
		<pre class="file" id="file5" style="display: none">package handlers

import (
        "log"

        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// BotHandlers —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞
type BotHandlers struct {
        bot *tgbotapi.BotAPI
}

// NewBotHandlers —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä BotHandlers
func NewBotHandlers(bot *tgbotapi.BotAPI) *BotHandlers <span class="cov8" title="1">{
        return &amp;BotHandlers{
                bot: bot,
        }
}</span>

// HandleUnknownCommand –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
func (h *BotHandlers) HandleUnknownCommand(update tgbotapi.Update) <span class="cov0" title="0">{
        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞.\n\n"+
                        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.")
        h.bot.Send(msg)
}</span>

// HandleErrorMessage –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
func (h *BotHandlers) HandleErrorMessage(chatID int64, errorMsg string) <span class="cov0" title="0">{
        msg := tgbotapi.NewMessage(chatID,
                "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        h.bot.Send(msg)

        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        log.Printf("Error for user %d: %s", chatID, errorMsg)
}</span>

// SendWelcomeMessage –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
func (h *BotHandlers) SendWelcomeMessage(chatID int64) <span class="cov0" title="0">{
        msg := tgbotapi.NewMessage(chatID,
                `üêæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VetBot! üêæ

–Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã—Ö –≤—Ä–∞—á–µ–π. –Ø –º–æ–≥—É:

‚Ä¢ –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–∞—á–µ–π –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚Ä¢ –ù–∞–π—Ç–∏ –≤—Ä–∞—á–µ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å
‚Ä¢ –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–Ω–∏–∫
‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–µ–º–∞

–ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /help —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!`)
        h.bot.Send(msg)
}</span>
</pre>
		
		<pre class="file" id="file6" style="display: none">package handlers

import (
        "log"
        "strconv"
        "strings"

        "github.com/drerr0r/vetbot/pkg/utils"
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// MainHandler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
type MainHandler struct {
        bot           BotAPI   // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        db            Database // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        config        *utils.Config
        vetHandlers   *VetHandlers
        adminHandlers *AdminHandlers
}

// NewMainHandler —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä MainHandler
func NewMainHandler(bot BotAPI, db Database, config *utils.Config) *MainHandler <span class="cov8" title="1">{
        return &amp;MainHandler{
                bot:           bot,
                db:            db,
                config:        config,
                vetHandlers:   NewVetHandlers(bot, db),
                adminHandlers: NewAdminHandlers(bot, db, config), // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
        }
}</span>

// HandleUpdate –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç Telegram
func (h *MainHandler) HandleUpdate(update tgbotapi.Update) <span class="cov0" title="0">{
        log.Printf("Received update")

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º callback queries (–Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏)
        if update.CallbackQuery != nil </span><span class="cov0" title="0">{
                log.Printf("Callback query: %s", update.CallbackQuery.Data)
                h.vetHandlers.HandleCallback(update)
                return
        }</span>

        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ª—é–±—ã–µ –Ω–µ-text —Å–æ–æ–±—â–µ–Ω–∏—è
        <span class="cov0" title="0">if update.Message == nil </span><span class="cov0" title="0">{
                log.Printf("Message is nil")
                return
        }</span>

        <span class="cov0" title="0">if update.Message.Text == "" </span><span class="cov0" title="0">{
                log.Printf("Text is empty")
                return
        }</span>

        <span class="cov0" title="0">log.Printf("Processing message: %s", update.Message.Text)

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
        isAdmin := h.isAdmin(update.Message.From.ID)
        log.Printf("User %d is admin: %t", update.Message.From.ID, isAdmin)

        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º —Ä–µ–∂–∏–º–µ, –ø–µ—Ä–µ–¥–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–º —Ö–µ–Ω–¥–ª–µ—Ä–∞–º
        if isAdmin &amp;&amp; h.isInAdminMode(update.Message.From.ID) </span><span class="cov0" title="0">{
                log.Printf("Redirecting to admin handlers")
                h.adminHandlers.HandleAdminMessage(update)
                return
        }</span>

        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã –ø–æ–∏—Å–∫–∞ (/search_1, /search_2 –∏ —Ç.–¥.)
        <span class="cov0" title="0">if strings.HasPrefix(update.Message.Text, "/search_") </span><span class="cov0" title="0">{
                log.Printf("Is search command: %s", update.Message.Text)
                h.handleSearchCommand(update)
                return
        }</span>

        // –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ã—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
        <span class="cov0" title="0">if update.Message.IsCommand() </span><span class="cov0" title="0">{
                log.Printf("Is command: %s", update.Message.Command())
                h.handleCommand(update, isAdmin)
                return
        }</span>

        // –û–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        <span class="cov0" title="0">log.Printf("Is text message: %s", update.Message.Text)
        h.handleTextMessage(update)</span>
}

// handleCommand –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
func (h *MainHandler) handleCommand(update tgbotapi.Update, isAdmin bool) <span class="cov0" title="0">{
        command := update.Message.Command()
        log.Printf("Handling command: %s", command)

        switch command </span>{
        case "start":<span class="cov0" title="0">
                log.Printf("Executing /start")
                h.vetHandlers.HandleStart(update)</span>
        case "specializations":<span class="cov0" title="0">
                log.Printf("Executing /specializations")
                h.vetHandlers.HandleSpecializations(update)</span>
        case "search":<span class="cov0" title="0">
                log.Printf("Executing /search")
                h.vetHandlers.HandleSearch(update)</span>
        case "clinics":<span class="cov0" title="0">
                log.Printf("Executing /clinics")
                h.vetHandlers.HandleClinics(update)</span>
        case "help":<span class="cov0" title="0">
                log.Printf("Executing /help")
                h.vetHandlers.HandleHelp(update)</span>
        case "test":<span class="cov0" title="0">
                log.Printf("Executing /test")
                h.vetHandlers.HandleTest(update)</span>
        case "admin":<span class="cov0" title="0">
                if isAdmin </span><span class="cov0" title="0">{
                        log.Printf("Executing /admin")
                        h.adminHandlers.HandleAdmin(update)
                }</span> else<span class="cov0" title="0"> {
                        log.Printf("Admin access denied for user %d", update.Message.From.ID)
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
                        h.bot.Send(msg)
                }</span>
        case "stats":<span class="cov0" title="0">
                if isAdmin </span><span class="cov0" title="0">{
                        log.Printf("Executing /stats")
                        h.adminHandlers.HandleStats(update)
                }</span>
        default:<span class="cov0" title="0">
                log.Printf("Unknown command: %s", command)
                msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                        "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥")
                h.bot.Send(msg)</span>
        }
}

// handleSearchCommand –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ–∏—Å–∫–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (/search_1, /search_2 –∏ —Ç.–¥.)
func (h *MainHandler) handleSearchCommand(update tgbotapi.Update) <span class="cov0" title="0">{
        text := update.Message.Text
        log.Printf("Handling search command: %s", text)

        if strings.HasPrefix(text, "/search_") </span><span class="cov0" title="0">{
                specIDStr := strings.TrimPrefix(text, "/search_")
                specID, err := strconv.Atoi(specIDStr)
                if err != nil </span><span class="cov0" title="0">{
                        log.Printf("Error parsing specialization ID: %v", err)
                        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ–∏—Å–∫–∞")
                        h.bot.Send(msg)
                        return
                }</span>
                <span class="cov0" title="0">log.Printf("Searching for specialization ID: %d", specID)
                h.vetHandlers.HandleSearchBySpecialization(update, specID)</span>
        }
}

// handleTextMessage –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
func (h *MainHandler) handleTextMessage(update tgbotapi.Update) <span class="cov0" title="0">{
        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–∫—É
        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                "–Ø –ø–æ–Ω–∏–º–∞—é —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.")
        h.bot.Send(msg)
}</span>

// isAdmin –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
func (h *MainHandler) isAdmin(userID int64) bool <span class="cov8" title="1">{
        if h.config == nil || len(h.config.AdminIDs) == 0 </span><span class="cov8" title="1">{
                log.Printf("Config or AdminIDs is empty")
                return false
        }</span>

        <span class="cov8" title="1">for _, adminID := range h.config.AdminIDs </span><span class="cov8" title="1">{
                if userID == adminID </span><span class="cov8" title="1">{
                        log.Printf("User %d found in admin list", userID)
                        return true
                }</span>
        }

        <span class="cov8" title="1">log.Printf("User %d not found in admin list: %v", userID, h.config.AdminIDs)
        return false</span>
}

// isInAdminMode –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º —Ä–µ–∂–∏–º–µ
func (h *MainHandler) isInAdminMode(userID int64) bool <span class="cov8" title="1">{
        // –ó–∞—â–∏—Ç–∞ –æ—Ç nil —É–∫–∞–∑–∞—Ç–µ–ª—è
        if h.adminHandlers == nil </span><span class="cov8" title="1">{
                log.Printf("Admin handlers is nil for user %d", userID)
                return false
        }</span>

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–¥–º–∏–Ω—Å–∫–æ–π —Å–µ—Å—Å–∏–∏
        <span class="cov8" title="1">if state, exists := h.adminHandlers.adminState[userID]; exists </span><span class="cov8" title="1">{
                return state != ""
        }</span>
        <span class="cov8" title="1">return false</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package handlers

import (
        "database/sql"
        "fmt"

        "github.com/drerr0r/vetbot/internal/models"
        "github.com/drerr0r/vetbot/pkg/utils"
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// ============================================================================
// MOCK DATABASE
// ============================================================================

// MockDatabase –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–∫ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
type MockDatabase struct {
        Users                map[int64]*models.User
        Specializations      map[int]*models.Specialization
        Veterinarians        map[int]*models.Veterinarian
        Clinics              map[int]*models.Clinic
        Schedules            map[int]*models.Schedule
        UserError            error
        SpecializationsError error
        VeterinariansError   error
        ClinicsError         error
        SchedulesError       error
}

// NewMockDatabase —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –º–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
func NewMockDatabase() *MockDatabase <span class="cov8" title="1">{
        return &amp;MockDatabase{
                Users:           make(map[int64]*models.User),
                Specializations: make(map[int]*models.Specialization),
                Veterinarians:   make(map[int]*models.Veterinarian),
                Clinics:         make(map[int]*models.Clinic),
                Schedules:       make(map[int]*models.Schedule),
        }
}</span>

// GetDB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
func (m *MockDatabase) GetDB() *sql.DB <span class="cov0" title="0">{
        return nil // –í–æ–∑–≤—Ä–∞—â–∞–µ–º nil –¥–ª—è —Ç–µ—Å—Ç–æ–≤
}</span>

// Close –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
func (m *MockDatabase) Close() error <span class="cov0" title="0">{
        return nil
}</span>

// CreateUser —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
func (m *MockDatabase) CreateUser(user *models.User) error <span class="cov8" title="1">{
        if m.UserError != nil </span><span class="cov8" title="1">{
                return m.UserError
        }</span>
        <span class="cov8" title="1">m.Users[user.TelegramID] = user
        return nil</span>
}

// GetAllSpecializations –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (m *MockDatabase) GetAllSpecializations() ([]*models.Specialization, error) <span class="cov8" title="1">{
        if m.SpecializationsError != nil </span><span class="cov8" title="1">{
                return nil, m.SpecializationsError
        }</span>

        <span class="cov8" title="1">result := make([]*models.Specialization, 0, len(m.Specializations))
        for _, spec := range m.Specializations </span><span class="cov8" title="1">{
                result = append(result, spec)
        }</span>
        <span class="cov8" title="1">return result, nil</span>
}

// GetSpecializationByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ ID
func (m *MockDatabase) GetSpecializationByID(id int) (*models.Specialization, error) <span class="cov8" title="1">{
        if m.SpecializationsError != nil </span><span class="cov0" title="0">{
                return nil, m.SpecializationsError
        }</span>

        <span class="cov8" title="1">spec, exists := m.Specializations[id]
        if !exists </span><span class="cov8" title="1">{
                return nil, sql.ErrNoRows
        }</span>
        <span class="cov8" title="1">return spec, nil</span>
}

// SpecializationExists –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (m *MockDatabase) SpecializationExists(id int) (bool, error) <span class="cov0" title="0">{
        _, exists := m.Specializations[id]
        return exists, nil
}</span>

// GetVeterinariansBySpecialization –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–∞—á–µ–π –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (m *MockDatabase) GetVeterinariansBySpecialization(specializationID int) ([]*models.Veterinarian, error) <span class="cov8" title="1">{
        if m.VeterinariansError != nil </span><span class="cov8" title="1">{
                return nil, m.VeterinariansError
        }</span>

        <span class="cov8" title="1">result := make([]*models.Veterinarian, 0)
        for _, vet := range m.Veterinarians </span><span class="cov8" title="1">{
                for _, spec := range vet.Specializations </span><span class="cov8" title="1">{
                        if spec.ID == specializationID </span><span class="cov8" title="1">{
                                result = append(result, vet)
                                break</span>
                        }
                }
        }
        <span class="cov8" title="1">return result, nil</span>
}

// GetAllClinics –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∫–ª–∏–Ω–∏–∫–∏
func (m *MockDatabase) GetAllClinics() ([]*models.Clinic, error) <span class="cov8" title="1">{
        if m.ClinicsError != nil </span><span class="cov8" title="1">{
                return nil, m.ClinicsError
        }</span>

        <span class="cov8" title="1">result := make([]*models.Clinic, 0, len(m.Clinics))
        for _, clinic := range m.Clinics </span><span class="cov8" title="1">{
                result = append(result, clinic)
        }</span>
        <span class="cov8" title="1">return result, nil</span>
}

// GetSchedulesByVetID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–∞—á–∞
func (m *MockDatabase) GetSchedulesByVetID(vetID int) ([]*models.Schedule, error) <span class="cov8" title="1">{
        if m.SchedulesError != nil </span><span class="cov0" title="0">{
                return nil, m.SchedulesError
        }</span>

        <span class="cov8" title="1">result := make([]*models.Schedule, 0)
        for _, schedule := range m.Schedules </span><span class="cov8" title="1">{
                if schedule.VetID == vetID </span><span class="cov8" title="1">{
                        result = append(result, schedule)
                }</span>
        }
        <span class="cov8" title="1">return result, nil</span>
}

// GetSpecializationsByVetID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
func (m *MockDatabase) GetSpecializationsByVetID(vetID int) ([]*models.Specialization, error) <span class="cov8" title="1">{
        vet, exists := m.Veterinarians[vetID]
        if !exists </span><span class="cov0" title="0">{
                return nil, sql.ErrNoRows
        }</span>
        <span class="cov8" title="1">return vet.Specializations, nil</span>
}

// FindAvailableVets –∏—â–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—á–µ–π
func (m *MockDatabase) FindAvailableVets(criteria *models.SearchCriteria) ([]*models.Veterinarian, error) <span class="cov8" title="1">{
        if m.VeterinariansError != nil </span><span class="cov0" title="0">{
                return nil, m.VeterinariansError
        }</span>

        <span class="cov8" title="1">result := make([]*models.Veterinarian, 0)

        for _, vet := range m.Veterinarians </span><span class="cov8" title="1">{
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                if criteria.SpecializationID &gt; 0 </span><span class="cov0" title="0">{
                        found := false
                        for _, spec := range vet.Specializations </span><span class="cov0" title="0">{
                                if spec.ID == criteria.SpecializationID </span><span class="cov0" title="0">{
                                        found = true
                                        break</span>
                                }
                        }
                        <span class="cov0" title="0">if !found </span><span class="cov0" title="0">{
                                continue</span>
                        }
                }

                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–Ω—é –Ω–µ–¥–µ–ª–∏
                <span class="cov8" title="1">if criteria.DayOfWeek &gt; 0 </span><span class="cov8" title="1">{
                        hasSchedule := false
                        for _, schedule := range m.Schedules </span><span class="cov8" title="1">{
                                if schedule.VetID == vet.ID &amp;&amp; schedule.DayOfWeek == criteria.DayOfWeek </span><span class="cov8" title="1">{
                                        hasSchedule = true
                                        break</span>
                                }
                        }
                        <span class="cov8" title="1">if !hasSchedule </span><span class="cov8" title="1">{
                                continue</span>
                        }
                }

                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª–∏–Ω–∏–∫–µ
                <span class="cov8" title="1">if criteria.ClinicID &gt; 0 </span><span class="cov8" title="1">{
                        hasClinic := false
                        for _, schedule := range m.Schedules </span><span class="cov8" title="1">{
                                if schedule.VetID == vet.ID &amp;&amp; schedule.ClinicID == criteria.ClinicID </span><span class="cov8" title="1">{
                                        hasClinic = true
                                        break</span>
                                }
                        }
                        <span class="cov8" title="1">if !hasClinic </span><span class="cov0" title="0">{
                                continue</span>
                        }
                }

                <span class="cov8" title="1">result = append(result, vet)</span>
        }

        <span class="cov8" title="1">return result, nil</span>
}

// GetAllVeterinarians –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ—Ö –≤—Ä–∞—á–µ–π
func (m *MockDatabase) GetAllVeterinarians() ([]*models.Veterinarian, error) <span class="cov0" title="0">{
        result := make([]*models.Veterinarian, 0, len(m.Veterinarians))
        for _, vet := range m.Veterinarians </span><span class="cov0" title="0">{
                result = append(result, vet)
        }</span>
        <span class="cov0" title="0">return result, nil</span>
}

// GetVeterinarianByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–∞—á–∞ –ø–æ ID
func (m *MockDatabase) GetVeterinarianByID(id int) (*models.Veterinarian, error) <span class="cov0" title="0">{
        vet, exists := m.Veterinarians[id]
        if !exists </span><span class="cov0" title="0">{
                return nil, sql.ErrNoRows
        }</span>
        <span class="cov0" title="0">return vet, nil</span>
}

// GetClinicByID –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–Ω–∏–∫—É –ø–æ ID
func (m *MockDatabase) GetClinicByID(id int) (*models.Clinic, error) <span class="cov0" title="0">{
        clinic, exists := m.Clinics[id]
        if !exists </span><span class="cov0" title="0">{
                return nil, sql.ErrNoRows
        }</span>
        <span class="cov0" title="0">return clinic, nil</span>
}

// AddMissingColumns –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
func (m *MockDatabase) AddMissingColumns() error <span class="cov0" title="0">{
        return nil
}</span>

// AddTestVeterinarian –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞
func (m *MockDatabase) AddTestVeterinarian(id int, firstName, lastName, phone string) <span class="cov0" title="0">{
        m.Veterinarians[id] = &amp;models.Veterinarian{
                ID:              id,
                FirstName:       firstName,
                LastName:        lastName,
                Phone:           phone,
                Specializations: []*models.Specialization{},
        }
}</span>

// AddTestSpecialization –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
func (m *MockDatabase) AddTestSpecialization(id int, name string) <span class="cov0" title="0">{
        m.Specializations[id] = &amp;models.Specialization{
                ID:   id,
                Name: name,
        }
}</span>

// ============================================================================
// MOCK BOT
// ============================================================================

// MockBot –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–∫ –¥–ª—è Telegram –±–æ—Ç–∞
type MockBot struct {
        SentMessages   []tgbotapi.MessageConfig
        Callbacks      []tgbotapi.CallbackConfig
        EditedMessages []tgbotapi.EditMessageTextConfig
}

// NewMockBot —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –º–æ–∫ –±–æ—Ç–∞
func NewMockBot() *MockBot <span class="cov8" title="1">{
        return &amp;MockBot{
                SentMessages:   make([]tgbotapi.MessageConfig, 0),
                Callbacks:      make([]tgbotapi.CallbackConfig, 0),
                EditedMessages: make([]tgbotapi.EditMessageTextConfig, 0),
        }
}</span>

// Send –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
func (m *MockBot) Send(c tgbotapi.Chattable) (tgbotapi.Message, error) <span class="cov8" title="1">{
        switch msg := c.(type) </span>{
        case tgbotapi.MessageConfig:<span class="cov8" title="1">
                m.SentMessages = append(m.SentMessages, msg)
                return tgbotapi.Message{MessageID: len(m.SentMessages)}, nil</span>
        case tgbotapi.CallbackConfig:<span class="cov8" title="1">
                m.Callbacks = append(m.Callbacks, msg)
                return tgbotapi.Message{}, nil</span>
        case tgbotapi.EditMessageTextConfig:<span class="cov8" title="1">
                m.EditedMessages = append(m.EditedMessages, msg)
                return tgbotapi.Message{MessageID: len(m.EditedMessages)}, nil</span>
        default:<span class="cov0" title="0">
                return tgbotapi.Message{}, fmt.Errorf("unsupported message type: %T", c)</span>
        }
}

// Request –∏–º–∏—Ç–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
func (m *MockBot) Request(c tgbotapi.Chattable) (*tgbotapi.APIResponse, error) <span class="cov8" title="1">{
        return &amp;tgbotapi.APIResponse{Ok: true}, nil
}</span>

// GetSentMessages –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
func (m *MockBot) GetSentMessages() []tgbotapi.MessageConfig <span class="cov0" title="0">{
        return m.SentMessages
}</span>

// GetLastMessage –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
func (m *MockBot) GetLastMessage() *tgbotapi.MessageConfig <span class="cov8" title="1">{
        if len(m.SentMessages) == 0 </span><span class="cov0" title="0">{
                return nil
        }</span>
        <span class="cov8" title="1">return &amp;m.SentMessages[len(m.SentMessages)-1]</span>
}

// GetLastEditedMessage –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
func (m *MockBot) GetLastEditedMessage() *tgbotapi.EditMessageTextConfig <span class="cov8" title="1">{
        if len(m.EditedMessages) == 0 </span><span class="cov0" title="0">{
                return nil
        }</span>
        <span class="cov8" title="1">return &amp;m.EditedMessages[len(m.EditedMessages)-1]</span>
}

// Clear –æ—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
func (m *MockBot) Clear() <span class="cov0" title="0">{
        m.SentMessages = make([]tgbotapi.MessageConfig, 0)
        m.Callbacks = make([]tgbotapi.CallbackConfig, 0)
        m.EditedMessages = make([]tgbotapi.EditMessageTextConfig, 0)
}</span>

// ============================================================================
// TEST UTILITIES
// ============================================================================

// TestUpdateBuilder –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
type TestUpdateBuilder struct {
        update tgbotapi.Update
}

// NewTestUpdate —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –±–∏–ª–¥–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
func NewTestUpdate() *TestUpdateBuilder <span class="cov8" title="1">{
        return &amp;TestUpdateBuilder{
                update: tgbotapi.Update{},
        }
}</span>

// WithMessage –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
func (b *TestUpdateBuilder) WithMessage(text string, chatID int64, userID int64) *TestUpdateBuilder <span class="cov8" title="1">{
        b.update.Message = &amp;tgbotapi.Message{
                Text: text,
                Chat: &amp;tgbotapi.Chat{ID: chatID},
                From: &amp;tgbotapi.User{ID: userID},
        }
        return b
}</span>

// WithCallback –¥–æ–±–∞–≤–ª—è–µ—Ç callback query
func (b *TestUpdateBuilder) WithCallback(data string, chatID int64, messageID int) *TestUpdateBuilder <span class="cov8" title="1">{
        b.update.CallbackQuery = &amp;tgbotapi.CallbackQuery{
                ID:      "test_callback",
                Data:    data,
                Message: &amp;tgbotapi.Message{Chat: &amp;tgbotapi.Chat{ID: chatID}, MessageID: messageID},
        }
        return b
}</span>

// Build –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
func (b *TestUpdateBuilder) Build() tgbotapi.Update <span class="cov8" title="1">{
        return b.update
}</span>

// CreateTestConfig —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
func CreateTestConfig() *utils.Config <span class="cov8" title="1">{
        return &amp;utils.Config{
                TelegramToken: "test_token",
                DatabaseURL:   "test_url",
                Debug:         true,
                AdminIDs:      []int64{12345},
        }
}</span>

// CreateTestMainHandlers —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ MainHandler
func CreateTestMainHandlers() (*MainHandler, *MockBot) <span class="cov0" title="0">{
        mockBot := NewMockBot()

        // –°–æ–∑–¥–∞–µ–º nil –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        var db Database = nil
        config := CreateTestConfig()

        mainHandler := NewMainHandler(mockBot, db, config)
        return mainHandler, mockBot
}</span>

// CreateTestVetHandlers —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ VetHandlers
func CreateTestVetHandlers() (*VetHandlers, *MockBot, *MockDatabase) <span class="cov0" title="0">{
        mockBot := NewMockBot()
        mockDB := NewMockDatabase()
        handlers := NewVetHandlers(mockBot, mockDB)
        return handlers, mockBot, mockDB
}</span>

// CreateTestAdminHandlers —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ AdminHandlers
func CreateTestAdminHandlers() (*AdminHandlers, *MockBot, *MockDatabase) <span class="cov0" title="0">{
        mockBot := NewMockBot()
        mockDB := NewMockDatabase()
        config := CreateTestConfig()
        handlers := NewAdminHandlers(mockBot, mockDB, config)
        return handlers, mockBot, mockDB
}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">package handlers

import (
        "fmt"
        "html"
        "log"
        "strconv"
        "strings"

        "github.com/drerr0r/vetbot/internal/models"
        tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

// VetHandlers —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–æ–≥–æ –±–æ—Ç–∞
type VetHandlers struct {
        bot BotAPI
        db  Database
}

// NewVetHandlers —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä VetHandlers
func NewVetHandlers(bot BotAPI, db Database) *VetHandlers <span class="cov8" title="1">{
        return &amp;VetHandlers{
                bot: bot,
                db:  db,
        }
}</span>

// HandleStart –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /start
func (h *VetHandlers) HandleStart(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleStart called")

        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user := &amp;models.User{
                TelegramID: update.Message.From.ID,
                Username:   update.Message.From.UserName,
                FirstName:  update.Message.From.FirstName,
                LastName:   update.Message.From.LastName,
        }

        err := h.db.CreateUser(user)
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error creating user: %v", err)
        }</span>

        // –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
        <span class="cov8" title="1">keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîç –ü–æ–∏—Å–∫ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º", "main_specializations"),
                        tgbotapi.NewInlineKeyboardButtonData("üïê –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏", "main_time"),
                ),
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üè• –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–Ω–∏–∫–∞–º", "main_clinics"),
                        tgbotapi.NewInlineKeyboardButtonData("‚ÑπÔ∏è –ü–æ–º–æ—â—å", "main_help"),
                ),
        )

        msg := tgbotapi.NewMessage(update.Message.Chat.ID,
                `üêæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VetBot! üêæ

–Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã—Ö –≤—Ä–∞—á–µ–π. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞:`)
        msg.ReplyMarkup = keyboard

        log.Printf("Sending start message with inline keyboard")
        _, err = h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending start message: %v", err)
        }</span> else<span class="cov8" title="1"> {
                log.Printf("Start message sent successfully")
        }</span>
}

// HandleSpecializations –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
func (h *VetHandlers) HandleSpecializations(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleSpecializations called")

        var chatID int64

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º chatID –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ update
        if update.CallbackQuery != nil </span><span class="cov8" title="1">{
                chatID = update.CallbackQuery.Message.Chat.ID
                // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback query —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å "—á–∞—Å–∏–∫–∏" —É –∫–Ω–æ–ø–∫–∏
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov8" title="1"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov8" title="1"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        <span class="cov8" title="1">specializations, err := h.db.GetAllSpecializations()
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error getting specializations: %v", err)
                msg := tgbotapi.NewMessage(chatID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Found %d specializations", len(specializations))

        if len(specializations) == 0 </span><span class="cov8" title="1">{
                msg := tgbotapi.NewMessage(chatID, "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                return
        }</span>

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π (–º–∞–∫—Å–∏–º—É–º 3 –≤ —Ä—è–¥—É)
        <span class="cov8" title="1">var keyboardRows [][]tgbotapi.InlineKeyboardButton
        var currentRow []tgbotapi.InlineKeyboardButton

        for i, spec := range specializations </span><span class="cov8" title="1">{
                btn := tgbotapi.NewInlineKeyboardButtonData(
                        spec.Name,
                        fmt.Sprintf("search_spec_%d", spec.ID),
                )
                currentRow = append(currentRow, btn)

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ä—è–¥ –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 3 –∫–Ω–æ–ø–æ–∫ –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ
                if (i+1)%3 == 0 || i == len(specializations)-1 </span><span class="cov8" title="1">{
                        keyboardRows = append(keyboardRows, currentRow)
                        currentRow = []tgbotapi.InlineKeyboardButton{}
                }</span>
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        <span class="cov8" title="1">backRow := tgbotapi.NewInlineKeyboardRow(
                tgbotapi.NewInlineKeyboardButtonData("üîô –ù–∞–∑–∞–¥", "main_menu"),
        )
        keyboardRows = append(keyboardRows, backRow)

        keyboard := tgbotapi.NewInlineKeyboardMarkup(keyboardRows...)

        msg := tgbotapi.NewMessage(chatID,
                "üè• *–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Ä–∞—á–∞:*\n\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Å –Ω—É–∂–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π.")
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        log.Printf("Sending specializations menu to chat %d", chatID)
        _, err = h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending specializations menu: %v", err)
        }</span>
}

// HandleSearch –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
func (h *VetHandlers) HandleSearch(update tgbotapi.Update) <span class="cov0" title="0">{
        log.Printf("HandleSearch called")

        var chatID int64

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º chatID –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ update
        if update.CallbackQuery != nil </span><span class="cov0" title="0">{
                chatID = update.CallbackQuery.Message.Chat.ID
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov0" title="0"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov0" title="0"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        // –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏ –∏ –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
        <span class="cov0" title="0">keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "search_day_1"),
                        tgbotapi.NewInlineKeyboardButtonData("–í—Ç–æ—Ä–Ω–∏–∫", "search_day_2"),
                        tgbotapi.NewInlineKeyboardButtonData("–°—Ä–µ–¥–∞", "search_day_3"),
                ),
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("–ß–µ—Ç–≤–µ—Ä–≥", "search_day_4"),
                        tgbotapi.NewInlineKeyboardButtonData("–ü—è—Ç–Ω–∏—Ü–∞", "search_day_5"),
                        tgbotapi.NewInlineKeyboardButtonData("–°—É–±–±–æ—Ç–∞", "search_day_6"),
                ),
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", "search_day_7"),
                        tgbotapi.NewInlineKeyboardButtonData("–õ—é–±–æ–π –¥–µ–Ω—å", "search_day_0"),
                ),
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîô –ù–∞–∑–∞–¥", "main_menu"),
                ),
        )

        msg := tgbotapi.NewMessage(chatID,
                "üïê *–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞:*\n\n–Ø –ø–æ–∫–∞–∂—É –≤—Ä–∞—á–µ–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å.")
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        log.Printf("Sending search by time menu to chat %d", chatID)
        _, err := h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending search menu: %v", err)
        }</span>
}

// HandleClinics –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –∫–ª–∏–Ω–∏–∫
func (h *VetHandlers) HandleClinics(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleClinics called")

        var chatID int64

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º chatID –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ update
        if update.CallbackQuery != nil </span><span class="cov8" title="1">{
                chatID = update.CallbackQuery.Message.Chat.ID
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov0" title="0"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov0" title="0"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        <span class="cov8" title="1">clinics, err := h.db.GetAllClinics()
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error getting clinics: %v", err)
                msg := tgbotapi.NewMessage(chatID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–Ω–∏–∫")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Found %d clinics", len(clinics))

        if len(clinics) == 0 </span><span class="cov0" title="0">{
                msg := tgbotapi.NewMessage(chatID, "–ö–ª–∏–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                h.bot.Send(msg)
                return
        }</span>

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–ª–∏–Ω–∏–∫
        <span class="cov8" title="1">var keyboardRows [][]tgbotapi.InlineKeyboardButton
        var currentRow []tgbotapi.InlineKeyboardButton

        for i, clinic := range clinics </span><span class="cov8" title="1">{
                btn := tgbotapi.NewInlineKeyboardButtonData(
                        clinic.Name,
                        fmt.Sprintf("search_clinic_%d", clinic.ID),
                )
                currentRow = append(currentRow, btn)

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ä—è–¥ –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 2 –∫–Ω–æ–ø–æ–∫ –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ
                if (i+1)%2 == 0 || i == len(clinics)-1 </span><span class="cov8" title="1">{
                        keyboardRows = append(keyboardRows, currentRow)
                        currentRow = []tgbotapi.InlineKeyboardButton{}
                }</span>
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        <span class="cov8" title="1">backRow := tgbotapi.NewInlineKeyboardRow(
                tgbotapi.NewInlineKeyboardButtonData("üîô –ù–∞–∑–∞–¥", "main_menu"),
        )
        keyboardRows = append(keyboardRows, backRow)

        keyboard := tgbotapi.NewInlineKeyboardMarkup(keyboardRows...)

        msg := tgbotapi.NewMessage(chatID,
                "üè• *–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–Ω–∏–∫—É:*\n\n–Ø –ø–æ–∫–∞–∂—É –≤—Ä–∞—á–µ–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–ª–∏–Ω–∏–∫–µ.")
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        log.Printf("Sending clinics menu to chat %d", chatID)
        _, err = h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending clinics menu: %v", err)
        }</span>
}

// HandleHelp –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
func (h *VetHandlers) HandleHelp(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleHelp called")

        var chatID int64

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º chatID –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ update
        if update.CallbackQuery != nil </span><span class="cov8" title="1">{
                chatID = update.CallbackQuery.Message.Chat.ID
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov0" title="0"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov0" title="0"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        <span class="cov8" title="1">keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîô –ù–∞–∑–∞–¥", "main_menu"),
                ),
        )

        helpText := `üêæ *VetBot - –ü–æ–º–æ—â—å* üêæ

*–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ üîç *–ü–æ–∏—Å–∫ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º* - –Ω–∞–π—Ç–∏ –≤—Ä–∞—á–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é
‚Ä¢ üïê *–ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏* - –Ω–∞–π—Ç–∏ –≤—Ä–∞—á–∞ –ø–æ –¥–Ω—é –Ω–µ–¥–µ–ª–∏
‚Ä¢ üè• *–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–Ω–∏–∫–∞–º* - –Ω–∞–π—Ç–∏ –≤—Ä–∞—á–µ–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–ª–∏–Ω–∏–∫–µ

*–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:*
1. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –¥–µ–Ω—å –∏–ª–∏ –∫–ª–∏–Ω–∏–∫–∞)
3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

*–ö–æ–º–∞–Ω–¥—ã:*
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞`

        msg := tgbotapi.NewMessage(chatID, helpText)
        msg.ParseMode = "Markdown"
        msg.ReplyMarkup = keyboard

        log.Printf("Sending help message to chat %d", chatID)
        _, err := h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending help message: %v", err)
        }</span>
}

// HandleSearchBySpecialization –∏—â–µ—Ç –≤—Ä–∞—á–µ–π –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
func (h *VetHandlers) HandleSearchBySpecialization(update tgbotapi.Update, specializationID int) <span class="cov8" title="1">{
        log.Printf("HandleSearchBySpecialization called with ID: %d", specializationID)

        var chatID int64
        var messageID int

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º chatID –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ update
        if update.CallbackQuery != nil </span><span class="cov8" title="1">{
                chatID = update.CallbackQuery.Message.Chat.ID
                messageID = update.CallbackQuery.Message.MessageID
                // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback query —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å "—á–∞—Å–∏–∫–∏" —É –∫–Ω–æ–ø–∫–∏
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov0" title="0"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov0" title="0"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        <span class="cov8" title="1">vets, err := h.db.GetVeterinariansBySpecialization(specializationID)
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error getting veterinarians: %v", err)
                msg := tgbotapi.NewMessage(chatID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤—Ä–∞—á–µ–π")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Found %d veterinarians for specialization ID: %d", len(vets), specializationID)

        spec, err := h.db.GetSpecializationByID(specializationID)
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error getting specialization: %v", err)
        }</span>

        // –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
        <span class="cov8" title="1">keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîô –ö —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º", "main_specializations"),
                        tgbotapi.NewInlineKeyboardButtonData("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "main_menu"),
                ),
        )

        if len(vets) == 0 </span><span class="cov8" title="1">{
                var specName string
                if spec != nil </span><span class="cov8" title="1">{
                        specName = spec.Name
                }</span> else<span class="cov0" title="0"> {
                        specName = "–≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏"
                }</span>

                <span class="cov8" title="1">msg := tgbotapi.NewMessage(chatID,
                        fmt.Sprintf("üë®‚Äç‚öïÔ∏è *–í—Ä–∞—á–∏ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ \"%s\" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã*\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é.", specName))
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
                return</span>
        }

        <span class="cov8" title="1">var sb strings.Builder
        if spec != nil </span><span class="cov8" title="1">{
                sb.WriteString(fmt.Sprintf("üë®‚Äç‚öïÔ∏è *–í—Ä–∞—á–∏ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ \"%s\":*\n\n", html.EscapeString(spec.Name)))
        }</span> else<span class="cov8" title="1"> {
                sb.WriteString("üë®‚Äç‚öïÔ∏è *–ù–∞–π–¥–µ–Ω–Ω—ã–µ –≤—Ä–∞—á–∏:*\n\n")
        }</span>

        <span class="cov8" title="1">for i, vet := range vets </span><span class="cov8" title="1">{
                sb.WriteString(fmt.Sprintf("**%d. %s %s**\n", i+1, html.EscapeString(vet.FirstName), html.EscapeString(vet.LastName)))
                sb.WriteString(fmt.Sprintf("üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* `%s`\n", html.EscapeString(vet.Phone)))

                if vet.Email.Valid &amp;&amp; vet.Email.String != "" </span><span class="cov8" title="1">{
                        sb.WriteString(fmt.Sprintf("üìß *Email:* %s\n", html.EscapeString(vet.Email.String)))
                }</span>

                <span class="cov8" title="1">if vet.ExperienceYears.Valid </span><span class="cov8" title="1">{
                        sb.WriteString(fmt.Sprintf("üíº *–û–ø—ã—Ç:* %d –ª–µ—Ç\n", vet.ExperienceYears.Int64))
                }</span>

                // –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
                <span class="cov8" title="1">if len(vet.Specializations) &gt; 0 </span><span class="cov8" title="1">{
                        sb.WriteString("üéØ *–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:* ")
                        specNames := make([]string, len(vet.Specializations))
                        for j, spec := range vet.Specializations </span><span class="cov8" title="1">{
                                specNames[j] = html.EscapeString(spec.Name)
                        }</span>
                        <span class="cov8" title="1">sb.WriteString(strings.Join(specNames, ", "))
                        sb.WriteString("\n")</span>
                }

                // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–∞—á–∞
                <span class="cov8" title="1">schedules, err := h.db.GetSchedulesByVetID(vet.ID)
                if err == nil &amp;&amp; len(schedules) &gt; 0 </span><span class="cov8" title="1">{
                        sb.WriteString("üïê *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:*\n")
                        for _, schedule := range schedules </span><span class="cov8" title="1">{
                                dayName := getDayName(schedule.DayOfWeek)
                                startTime := schedule.StartTime
                                endTime := schedule.EndTime
                                if startTime != "" &amp;&amp; endTime != "" &amp;&amp; startTime != "00:00" &amp;&amp; endTime != "00:00" </span><span class="cov8" title="1">{
                                        sb.WriteString(fmt.Sprintf("   - %s: %s-%s", dayName, startTime, endTime))
                                        if schedule.Clinic != nil &amp;&amp; schedule.Clinic.Name != "" </span><span class="cov8" title="1">{
                                                sb.WriteString(fmt.Sprintf(" (%s)", html.EscapeString(schedule.Clinic.Name)))
                                        }</span>
                                        <span class="cov8" title="1">sb.WriteString("\n")</span>
                                }
                        }
                }

                <span class="cov8" title="1">sb.WriteString("\n")</span>
        }

        // –ï—Å–ª–∏ —ç—Ç–æ callback query –∏ –µ—Å—Ç—å messageID, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        <span class="cov8" title="1">if update.CallbackQuery != nil &amp;&amp; messageID != 0 </span><span class="cov8" title="1">{
                editMsg := tgbotapi.NewEditMessageText(chatID, messageID, sb.String())
                editMsg.ParseMode = "Markdown"
                editMsg.ReplyMarkup = &amp;keyboard
                _, err = h.bot.Send(editMsg)
                if err != nil </span><span class="cov0" title="0">{
                        log.Printf("Error editing message: %v", err)
                        // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        msg := tgbotapi.NewMessage(chatID, sb.String())
                        msg.ParseMode = "Markdown"
                        msg.ReplyMarkup = keyboard
                        h.bot.Send(msg)
                }</span>
        } else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(chatID, sb.String())
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
        }</span>
}

// HandleSearchByClinic –∏—â–µ—Ç –≤—Ä–∞—á–µ–π –ø–æ –∫–ª–∏–Ω–∏–∫–µ
func (h *VetHandlers) HandleSearchByClinic(update tgbotapi.Update, clinicID int) <span class="cov8" title="1">{
        log.Printf("HandleSearchByClinic called with ID: %d", clinicID)

        var chatID int64
        var messageID int

        if update.CallbackQuery != nil </span><span class="cov8" title="1">{
                chatID = update.CallbackQuery.Message.Chat.ID
                messageID = update.CallbackQuery.Message.MessageID
                callback := tgbotapi.NewCallback(update.CallbackQuery.ID, "")
                h.bot.Send(callback)
        }</span> else<span class="cov0" title="0"> if update.Message != nil </span><span class="cov0" title="0">{
                chatID = update.Message.Chat.ID
        }</span> else<span class="cov0" title="0"> {
                log.Printf("Error: both CallbackQuery and Message are nil")
                return
        }</span>

        // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–∞—á–µ–π –∫–ª–∏–Ω–∏–∫–∏ —á–µ—Ä–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        <span class="cov8" title="1">criteria := &amp;models.SearchCriteria{
                ClinicID: clinicID,
        }
        vets, err := h.db.FindAvailableVets(criteria)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error finding vets by clinic: %v", err)
                msg := tgbotapi.NewMessage(chatID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤—Ä–∞—á–µ–π")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Found %d veterinarians for clinic ID: %d", len(vets), clinicID)

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–Ω–∏–∫–µ
        clinics, err := h.db.GetAllClinics()
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error getting clinics: %v", err)
                msg := tgbotapi.NewMessage(chatID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–Ω–∏–∫–µ")
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">var clinicName string
        for _, c := range clinics </span><span class="cov8" title="1">{
                if c.ID == clinicID </span><span class="cov8" title="1">{
                        clinicName = c.Name
                        break</span>
                }
        }

        // –ï—Å–ª–∏ –∫–ª–∏–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
        <span class="cov8" title="1">if clinicName == "" </span><span class="cov0" title="0">{
                clinicName = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞"
        }</span>

        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        <span class="cov8" title="1">keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîô –ö –∫–ª–∏–Ω–∏–∫–∞–º", "main_clinics"),
                        tgbotapi.NewInlineKeyboardButtonData("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "main_menu"),
                ),
        )

        if len(vets) == 0 </span><span class="cov8" title="1">{
                msg := tgbotapi.NewMessage(chatID,
                        fmt.Sprintf("üè• *–í—Ä–∞—á–∏ –≤ –∫–ª–∏–Ω–∏–∫–µ \"%s\" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã*\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–ª–∏–Ω–∏–∫—É.", clinicName))
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
                return
        }</span>

        <span class="cov8" title="1">var sb strings.Builder
        sb.WriteString(fmt.Sprintf("üè• *–í—Ä–∞—á–∏ –≤ –∫–ª–∏–Ω–∏–∫–µ \"%s\":*\n\n", html.EscapeString(clinicName)))

        for i, vet := range vets </span><span class="cov8" title="1">{
                sb.WriteString(fmt.Sprintf("**%d. %s %s**\n", i+1, html.EscapeString(vet.FirstName), html.EscapeString(vet.LastName)))
                sb.WriteString(fmt.Sprintf("üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* `%s`\n", html.EscapeString(vet.Phone)))

                if vet.Email.Valid &amp;&amp; vet.Email.String != "" </span><span class="cov8" title="1">{
                        sb.WriteString(fmt.Sprintf("üìß *Email:* %s\n", html.EscapeString(vet.Email.String)))
                }</span>

                <span class="cov8" title="1">if vet.ExperienceYears.Valid </span><span class="cov8" title="1">{
                        sb.WriteString(fmt.Sprintf("üíº *–û–ø—ã—Ç:* %d –ª–µ—Ç\n", vet.ExperienceYears.Int64))
                }</span>

                // –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Ä–∞—á–∞
                <span class="cov8" title="1">specs, err := h.db.GetSpecializationsByVetID(vet.ID)
                if err == nil &amp;&amp; len(specs) &gt; 0 </span><span class="cov0" title="0">{
                        sb.WriteString("üéØ *–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:* ")
                        specNames := make([]string, len(specs))
                        for j, spec := range specs </span><span class="cov0" title="0">{
                                specNames[j] = html.EscapeString(spec.Name)
                        }</span>
                        <span class="cov0" title="0">sb.WriteString(strings.Join(specNames, ", "))
                        sb.WriteString("\n")</span>
                }

                <span class="cov8" title="1">sb.WriteString("\n")</span>
        }

        <span class="cov8" title="1">if update.CallbackQuery != nil &amp;&amp; messageID != 0 </span><span class="cov8" title="1">{
                editMsg := tgbotapi.NewEditMessageText(chatID, messageID, sb.String())
                editMsg.ParseMode = "Markdown"
                editMsg.ReplyMarkup = &amp;keyboard
                h.bot.Send(editMsg)
        }</span> else<span class="cov0" title="0"> {
                msg := tgbotapi.NewMessage(chatID, sb.String())
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
        }</span>
}

// HandleCallback –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ inline callback –∑–∞–ø—Ä–æ—Å—ã
func (h *VetHandlers) HandleCallback(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleCallback called")

        callback := update.CallbackQuery
        data := callback.Data

        log.Printf("Callback data: %s", data)

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã callback –¥–∞–Ω–Ω—ã—Ö
        switch </span>{
        case data == "main_menu":<span class="cov8" title="1">
                h.showMainMenu(callback)</span>
        case data == "main_specializations":<span class="cov0" title="0">
                h.HandleSpecializations(update)</span>
        case data == "main_time":<span class="cov0" title="0">
                h.HandleSearch(update)</span>
        case data == "main_clinics":<span class="cov0" title="0">
                h.HandleClinics(update)</span>
        case data == "main_help":<span class="cov0" title="0">
                h.HandleHelp(update)</span>
        case strings.HasPrefix(data, "search_spec_"):<span class="cov8" title="1">
                h.handleSearchSpecCallback(callback)</span>
        case strings.HasPrefix(data, "search_day_"):<span class="cov0" title="0">
                h.handleDaySelection(callback)</span>
        case strings.HasPrefix(data, "search_clinic_"):<span class="cov0" title="0">
                h.handleSearchClinicCallback(callback)</span>
        default:<span class="cov8" title="1">
                // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π callback
                callbackConfig := tgbotapi.NewCallback(callback.ID, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞")
                h.bot.Request(callbackConfig)</span>
        }
}

// showMainMenu –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
func (h *VetHandlers) showMainMenu(callback *tgbotapi.CallbackQuery) <span class="cov8" title="1">{
        keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîç –ü–æ–∏—Å–∫ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–º", "main_specializations"),
                        tgbotapi.NewInlineKeyboardButtonData("üïê –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏", "main_time"),
                ),
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üè• –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–Ω–∏–∫–∞–º", "main_clinics"),
                        tgbotapi.NewInlineKeyboardButtonData("‚ÑπÔ∏è –ü–æ–º–æ—â—å", "main_help"),
                ),
        )

        editMsg := tgbotapi.NewEditMessageText(callback.Message.Chat.ID, callback.Message.MessageID,
                `üêæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VetBot! üêæ

–Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã—Ö –≤—Ä–∞—á–µ–π. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞:`)
        editMsg.ReplyMarkup = &amp;keyboard

        _, err := h.bot.Send(editMsg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error editing message to main menu: %v", err)
                // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                msg := tgbotapi.NewMessage(callback.Message.Chat.ID,
                        `üêæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VetBot! üêæ

–Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã—Ö –≤—Ä–∞—á–µ–π. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞:`)
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
        }</span>

        <span class="cov8" title="1">callbackConfig := tgbotapi.NewCallback(callback.ID, "")
        h.bot.Request(callbackConfig)</span>
}

// handleSearchSpecCallback –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç callback –ø–æ–∏—Å–∫–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
func (h *VetHandlers) handleSearchSpecCallback(callback *tgbotapi.CallbackQuery) <span class="cov8" title="1">{
        specIDStr := strings.TrimPrefix(callback.Data, "search_spec_")
        specID, err := strconv.Atoi(specIDStr)
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error parsing specialization ID: %v", err)
                callbackConfig := tgbotapi.NewCallback(callback.ID, "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞")
                h.bot.Request(callbackConfig)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Searching for specialization ID: %d", specID)

        // –°–æ–∑–¥–∞–µ–º update –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ HandleSearchBySpecialization
        update := tgbotapi.Update{
                CallbackQuery: callback,
        }
        h.HandleSearchBySpecialization(update, specID)</span>
}

// handleSearchClinicCallback –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç callback –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª–∏–Ω–∏–∫–µ
func (h *VetHandlers) handleSearchClinicCallback(callback *tgbotapi.CallbackQuery) <span class="cov0" title="0">{
        clinicIDStr := strings.TrimPrefix(callback.Data, "search_clinic_")
        clinicID, err := strconv.Atoi(clinicIDStr)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error parsing clinic ID: %v", err)
                callbackConfig := tgbotapi.NewCallback(callback.ID, "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞")
                h.bot.Request(callbackConfig)
                return
        }</span>

        <span class="cov0" title="0">log.Printf("Searching for clinic ID: %d", clinicID)

        update := tgbotapi.Update{
                CallbackQuery: callback,
        }
        h.HandleSearchByClinic(update, clinicID)</span>
}

// handleDaySelection –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–Ω—è –¥–ª—è –ø–æ–∏—Å–∫–∞
func (h *VetHandlers) handleDaySelection(callback *tgbotapi.CallbackQuery) <span class="cov8" title="1">{
        log.Printf("handleDaySelection called")

        data := callback.Data
        dayStr := strings.TrimPrefix(data, "search_day_")
        day, err := strconv.Atoi(dayStr)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error parsing day: %v", err)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Searching for day: %d", day)

        criteria := &amp;models.SearchCriteria{
                DayOfWeek: day,
        }

        vets, err := h.db.FindAvailableVets(criteria)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error finding vets: %v", err)
                callbackConfig := tgbotapi.NewCallback(callback.ID, "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤—Ä–∞—á–µ–π")
                h.bot.Request(callbackConfig)
                return
        }</span>

        <span class="cov8" title="1">log.Printf("Found %d vets for day %d", len(vets), day)

        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        keyboard := tgbotapi.NewInlineKeyboardMarkup(
                tgbotapi.NewInlineKeyboardRow(
                        tgbotapi.NewInlineKeyboardButtonData("üîô –ö –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏", "main_time"),
                        tgbotapi.NewInlineKeyboardButtonData("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "main_menu"),
                ),
        )

        if len(vets) == 0 </span><span class="cov8" title="1">{
                dayName := getDayName(day)
                msg := tgbotapi.NewMessage(callback.Message.Chat.ID,
                        fmt.Sprintf("üïê *–í—Ä–∞—á–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤ %s, –Ω–µ –Ω–∞–π–¥–µ–Ω—ã*\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –¥–µ–Ω—å.", dayName))
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
                callbackConfig := tgbotapi.NewCallback(callback.ID, "–ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω")
                h.bot.Request(callbackConfig)
                return
        }</span>

        <span class="cov8" title="1">var sb strings.Builder
        dayName := getDayName(day)
        sb.WriteString(fmt.Sprintf("üïê *–í—Ä–∞—á–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤ %s:*\n\n", dayName))

        for i, vet := range vets </span><span class="cov8" title="1">{
                sb.WriteString(fmt.Sprintf("**%d. %s %s**\n", i+1, html.EscapeString(vet.FirstName), html.EscapeString(vet.LastName)))
                sb.WriteString(fmt.Sprintf("üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* `%s`\n", html.EscapeString(vet.Phone)))

                if vet.Email.Valid &amp;&amp; vet.Email.String != "" </span><span class="cov0" title="0">{
                        sb.WriteString(fmt.Sprintf("üìß *Email:* %s\n", html.EscapeString(vet.Email.String)))
                }</span>

                <span class="cov8" title="1">if vet.ExperienceYears.Valid </span><span class="cov0" title="0">{
                        sb.WriteString(fmt.Sprintf("üíº *–û–ø—ã—Ç:* %d –ª–µ—Ç\n", vet.ExperienceYears.Int64))
                }</span>

                // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
                <span class="cov8" title="1">schedules, err := h.db.GetSchedulesByVetID(vet.ID)
                if err == nil </span><span class="cov8" title="1">{
                        for _, schedule := range schedules </span><span class="cov8" title="1">{
                                if schedule.DayOfWeek == day || day == 0 </span><span class="cov8" title="1">{
                                        scheduleDayName := getDayName(schedule.DayOfWeek)
                                        startTime := schedule.StartTime
                                        endTime := schedule.EndTime
                                        if startTime != "" &amp;&amp; endTime != "" &amp;&amp; startTime != "00:00" &amp;&amp; endTime != "00:00" </span><span class="cov8" title="1">{
                                                sb.WriteString(fmt.Sprintf("üïê *%s:* %s-%s", scheduleDayName, startTime, endTime))
                                                if schedule.Clinic != nil &amp;&amp; schedule.Clinic.Name != "" </span><span class="cov0" title="0">{
                                                        sb.WriteString(fmt.Sprintf(" (%s)", html.EscapeString(schedule.Clinic.Name)))
                                                }</span>
                                                <span class="cov8" title="1">sb.WriteString("\n")</span>
                                        }
                                }
                        }
                }
                <span class="cov8" title="1">sb.WriteString("\n")</span>
        }

        <span class="cov8" title="1">editMsg := tgbotapi.NewEditMessageText(callback.Message.Chat.ID, callback.Message.MessageID, sb.String())
        editMsg.ParseMode = "Markdown"
        editMsg.ReplyMarkup = &amp;keyboard

        _, err = h.bot.Send(editMsg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending day search results: %v", err)
                // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                msg := tgbotapi.NewMessage(callback.Message.Chat.ID, sb.String())
                msg.ParseMode = "Markdown"
                msg.ReplyMarkup = keyboard
                h.bot.Send(msg)
        }</span>

        <span class="cov8" title="1">callbackConfig := tgbotapi.NewCallback(callback.ID, "–ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω")
        h.bot.Request(callbackConfig)</span>
}

// HandleTest –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
func (h *VetHandlers) HandleTest(update tgbotapi.Update) <span class="cov8" title="1">{
        log.Printf("HandleTest called")

        msg := tgbotapi.NewMessage(update.Message.Chat.ID, "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!")
        _, err := h.bot.Send(msg)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error sending test message: %v", err)
        }</span> else<span class="cov8" title="1"> {
                log.Printf("Test message sent successfully")
        }</span>
}

// getDayName –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
func getDayName(day int) string <span class="cov8" title="1">{
        days := map[int]string{
                1: "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
                2: "–≤—Ç–æ—Ä–Ω–∏–∫",
                3: "—Å—Ä–µ–¥—É",
                4: "—á–µ—Ç–≤–µ—Ä–≥",
                5: "–ø—è—Ç–Ω–∏—Ü—É",
                6: "—Å—É–±–±–æ—Ç—É",
                7: "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
                0: "–ª—é–±–æ–π –¥–µ–Ω—å",
        }
        return days[day]
}</span>
</pre>
		
		<pre class="file" id="file9" style="display: none">package utils

import (
        "fmt"
        "log"
        "os"
        "strconv"
        "strings"
)

// Config —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
type Config struct {
        TelegramToken string
        DatabaseURL   string
        Debug         bool
        AdminIDs      []int64
}

// LoadConfig –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
func LoadConfig() (*Config, error) <span class="cov8" title="1">{
        config := &amp;Config{}

        // –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
        config.TelegramToken = getEnv("TELEGRAM_TOKEN", "")
        if config.TelegramToken == "" </span><span class="cov8" title="1">{
                return nil, fmt.Errorf("TELEGRAM_TOKEN is required")
        }</span>

        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        <span class="cov8" title="1">tokenPreview := config.TelegramToken
        if len(tokenPreview) &gt; 10 </span><span class="cov8" title="1">{
                tokenPreview = tokenPreview[:10] + "..."
        }</span>
        <span class="cov8" title="1">log.Printf("Telegram token loaded: %s", tokenPreview)

        // URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
        config.DatabaseURL = getEnv("DATABASE_URL", "")
        if config.DatabaseURL == "" </span><span class="cov8" title="1">{
                return nil, fmt.Errorf("DATABASE_URL is required")
        }</span>
        <span class="cov8" title="1">log.Printf("Database URL loaded: %s", config.DatabaseURL)

        // –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        debugStr := getEnv("DEBUG", "false")
        config.Debug, _ = strconv.ParseBool(debugStr)
        log.Printf("Debug mode: %t", config.Debug)

        // ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        adminIDsStr := getEnv("ADMIN_IDS", "")
        log.Printf("Raw ADMIN_IDS from env: '%s'", adminIDsStr)

        if adminIDsStr != "" </span><span class="cov8" title="1">{
                config.AdminIDs = parseAdminIDs(adminIDsStr)
                log.Printf("Loaded admin IDs: %v", config.AdminIDs)
        }</span> else<span class="cov8" title="1"> {
                log.Printf("No admin IDs configured")
        }</span>

        <span class="cov8" title="1">return config, nil</span>
}

// parseAdminIDs –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É —Å ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
func parseAdminIDs(adminIDsStr string) []int64 <span class="cov8" title="1">{
        var adminIDs []int64
        ids := strings.Split(adminIDsStr, ",")

        for _, idStr := range ids </span><span class="cov8" title="1">{
                idStr = strings.TrimSpace(idStr)
                if idStr == "" </span><span class="cov8" title="1">{
                        continue</span>
                }
                <span class="cov8" title="1">id, err := strconv.ParseInt(idStr, 10, 64)
                if err != nil </span><span class="cov8" title="1">{
                        log.Printf("Error parsing admin ID %s: %v", idStr, err)
                        continue</span>
                }
                <span class="cov8" title="1">adminIDs = append(adminIDs, id)</span>
        }

        <span class="cov8" title="1">return adminIDs</span>
}

// getEnv –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
func getEnv(key, defaultValue string) string <span class="cov8" title="1">{
        value := os.Getenv(key)
        if value == "" </span><span class="cov8" title="1">{
                return defaultValue
        }</span>
        <span class="cov8" title="1">return value</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
